import { Stack } from '@glimmer/util';
export class SymbolAllocator {
    constructor(ops) {
        this.ops = ops;
        this.symbolStack = new Stack();
    }
    process() {
        let out = [];
        let { ops } = this;
        for (let i = 0; i < ops.length; i++) {
            let op = ops[i];
            let result = this.dispatch(op);
            if (result === undefined) {
                out.push(op);
            } else {
                out.push(result);
            }
        }
        return out;
    }
    dispatch(op) {
        let name = op[0];
        let operand = op[1];
        return this[name](operand);
    }
    get symbols() {
        return this.symbolStack.current;
    }
    startProgram(op) {
        this.symbolStack.push(op['symbols']);
    }
    endProgram(_op) {
        this.symbolStack.pop();
    }
    startBlock(op) {
        this.symbolStack.push(op['symbols']);
    }
    endBlock(_op) {
        this.symbolStack.pop();
    }
    flushElement(op) {
        this.symbolStack.push(op['symbols']);
    }
    closeElement(_op) {
        this.symbolStack.pop();
    }
    closeComponent(_op) {
        this.symbolStack.pop();
    }
    closeDynamicComponent(_op) {
        this.symbolStack.pop();
    }
    attrSplat(_op) {
        return ['attrSplat', this.symbols.allocateBlock('attrs')];
    }
    get(op) {
        let [name, rest] = op;
        if (name === 0) {
            return ['get', [0, rest]];
        }
        if (isLocal(name, this.symbols)) {
            let head = this.symbols.get(name);
            return ['get', [head, rest]];
        } else if (name[0] === '@') {
            let head = this.symbols.allocateNamed(name);
            return ['get', [head, rest]];
        } else {
            return ['maybeLocal', [name, ...rest]];
        }
    }
    maybeGet(op) {
        let [name, rest] = op;
        if (name === 0) {
            return ['get', [0, rest]];
        }
        if (isLocal(name, this.symbols)) {
            let head = this.symbols.get(name);
            return ['get', [head, rest]];
        } else if (name[0] === '@') {
            let head = this.symbols.allocateNamed(name);
            return ['get', [head, rest]];
        } else if (rest.length === 0) {
            return ['unknown', name];
        } else {
            return ['maybeLocal', [name, ...rest]];
        }
    }
    yield(op) {
        if (op === 0) {
            throw new Error('Cannot yield to this');
        }
        return ['yield', this.symbols.allocateBlock(op)];
    }
    debugger(_op) {
        return ['debugger', this.symbols.getEvalInfo()];
    }
    hasBlock(op) {
        if (op === 0) {
            throw new Error('Cannot hasBlock this');
        }
        return ['hasBlock', this.symbols.allocateBlock(op)];
    }
    hasBlockParams(op) {
        if (op === 0) {
            throw new Error('Cannot hasBlockParams this');
        }
        return ['hasBlockParams', this.symbols.allocateBlock(op)];
    }
    partial(_op) {
        return ['partial', this.symbols.getEvalInfo()];
    }
    text(_op) {}
    comment(_op) {}
    openComponent(_op) {}
    openElement(_op) {}
    openSplattedElement(_op) {}
    staticArg(_op) {}
    dynamicArg(_op) {}
    staticAttr(_op) {}
    trustingAttr(_op) {}
    dynamicAttr(_op) {}
    modifier(_op) {}
    append(_op) {}
    block(_op) {}
    literal(_op) {}
    helper(_op) {}
    unknown(_op) {}
    maybeLocal(_op) {}
    prepareArray(_op) {}
    prepareObject(_op) {}
    concat(_op) {}
}
function isLocal(name, symbols) {
    return symbols && symbols.has(name);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxsb2NhdGUtc3ltYm9scy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL2NvbXBpbGVyL2xpYi9hbGxvY2F0ZS1zeW1ib2xzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLEFBQU8sU0FBRSxBQUFLLEFBQUUsQUFBTSxBQUFFLGFBQU0sQUFBZSxBQUFDO0FBaUI5QyxBQUFNLGFBQU8sQUFBZTtBQUkxQixnQkFBb0IsQUFBZ0I7QUFBaEIsYUFBRyxNQUFILEFBQUcsQUFBYTtBQUY1QixhQUFXLGNBQUcsSUFBSSxBQUFLLEFBQWUsQUFBQyxBQUVSO0FBQUM7QUFFeEMsQUFBTztBQUNMLFlBQUksQUFBRyxNQUFZLEFBQUUsQUFBQztBQUN0QixZQUFJLEVBQUUsQUFBRyxBQUFFLFFBQUcsQUFBSSxBQUFDO0FBRW5CLGFBQUssSUFBSSxBQUFDLElBQUcsQUFBQyxHQUFFLEFBQUMsSUFBRyxBQUFHLElBQUMsQUFBTSxRQUFFLEFBQUMsQUFBRSxLQUFFO0FBQ25DLGdCQUFJLEFBQUUsS0FBRyxBQUFHLElBQUMsQUFBQyxBQUFDLEFBQUM7QUFDaEIsZ0JBQUksQUFBTSxTQUFHLEFBQUksS0FBQyxBQUFRLFNBQUMsQUFBRSxBQUFDLEFBQUM7QUFFL0IsZ0JBQUksQUFBTSxXQUFLLEFBQVMsV0FBRTtBQUN4QixBQUFHLG9CQUFDLEFBQUksS0FBQyxBQUFXLEFBQUMsQUFBQztBQUN2QixtQkFBTTtBQUNMLEFBQUcsb0JBQUMsQUFBSSxLQUFDLEFBQWEsQUFBQyxBQUFDO0FBQ3pCO0FBQ0Y7QUFFRCxlQUFPLEFBQUcsQUFBQyxBQUNiO0FBQUM7QUFFRCxBQUFRLGFBQWlCLEFBQUs7QUFDNUIsWUFBSSxBQUFJLE9BQUcsQUFBRSxHQUFDLEFBQUMsQUFBQyxBQUFDO0FBQ2pCLFlBQUksQUFBTyxVQUFHLEFBQUUsR0FBQyxBQUFDLEFBQUMsQUFBQztBQUVwQixlQUFRLEFBQUksS0FBQyxBQUFJLEFBQVMs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QUFBTSxXQUFDLEFBQVMsS0FBRyxDQUFDLEFBQ3JCOztBQUVELFNBQVMsQUFBTyxRQUFDLEFBQVksTUFBRSxBQUFvQjtBQUNqRCxXQUFPLEFBQU8sV0FBSSxBQUFPLFFBQUMsQUFBRyxJQUFDLEFBQUksQUFBQyxBQUFDLEFBQ3RDO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21waWxlck9wcywgUHJvY2Vzc29yLCBPcCwgT3BOYW1lLCBUZW1wbGF0ZUNvbXBpbGVyT3BzLCBQYXRoSGVhZCB9IGZyb20gJy4vY29tcGlsZXItb3BzJztcbmltcG9ydCB7IEFTVCB9IGZyb20gJ0BnbGltbWVyL3N5bnRheCc7XG5pbXBvcnQgeyBPcHRpb24sIE9wYXF1ZSB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgU3RhY2ssIGV4cGVjdCB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgU3ltYm9sVGFibGUgfSBmcm9tICcuL3RlbXBsYXRlLXZpc2l0b3InO1xuXG5leHBvcnQgdHlwZSBJblZhcmlhYmxlID0gUGF0aEhlYWQ7XG5leHBvcnQgdHlwZSBPdXRWYXJpYWJsZSA9IG51bWJlcjtcblxuZXhwb3J0IHR5cGUgT3V0T3A8SyBleHRlbmRzIGtleW9mIENvbXBpbGVyT3BzPE91dFZhcmlhYmxlPiA9IE9wTmFtZT4gPSBPcDxcbiAgT3V0VmFyaWFibGUsXG4gIENvbXBpbGVyT3BzPE91dFZhcmlhYmxlPixcbiAgS1xuPjtcbmV4cG9ydCB0eXBlIEluT3A8SyBleHRlbmRzIGtleW9mIFRlbXBsYXRlQ29tcGlsZXJPcHMgPSBrZXlvZiBUZW1wbGF0ZUNvbXBpbGVyT3BzPiA9IE9wPFxuICBQYXRoSGVhZCxcbiAgVGVtcGxhdGVDb21waWxlck9wcyxcbiAgS1xuPjtcblxuZXhwb3J0IGNsYXNzIFN5bWJvbEFsbG9jYXRvclxuICBpbXBsZW1lbnRzIFByb2Nlc3NvcjxDb21waWxlck9wczxJblZhcmlhYmxlPiwgT3V0VmFyaWFibGUsIENvbXBpbGVyT3BzPE91dFZhcmlhYmxlPj4ge1xuICBwcml2YXRlIHN5bWJvbFN0YWNrID0gbmV3IFN0YWNrPFN5bWJvbFRhYmxlPigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgb3BzOiBBcnJheTxJbk9wPikge31cblxuICBwcm9jZXNzKCk6IE91dE9wW10ge1xuICAgIGxldCBvdXQ6IE91dE9wW10gPSBbXTtcbiAgICBsZXQgeyBvcHMgfSA9IHRoaXM7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9wcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IG9wID0gb3BzW2ldO1xuICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuZGlzcGF0Y2gob3ApO1xuXG4gICAgICBpZiAocmVzdWx0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgb3V0LnB1c2gob3AgYXMgT3V0T3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0LnB1c2gocmVzdWx0IGFzIGFueSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dDtcbiAgfVxuXG4gIGRpc3BhdGNoPE8gZXh0ZW5kcyBJbk9wPihvcDogTyk6IE9wYXF1ZSB7XG4gICAgbGV0IG5hbWUgPSBvcFswXTtcbiAgICBsZXQgb3BlcmFuZCA9IG9wWzFdO1xuXG4gICAgcmV0dXJuICh0aGlzW25hbWVdIGFzIGFueSkob3BlcmFuZCk7XG4gIH1cblxuICBnZXQgc3ltYm9scygpOiBTeW1ib2xUYWJsZSB7XG4gICAgcmV0dXJuIGV4cGVjdCh0aGlzLnN5bWJvbFN0YWNrLmN1cnJlbnQsICdFeHBlY3RlZCBhIHN5bWJvbCB0YWJsZSBvbiB0aGUgc3RhY2snKTtcbiAgfVxuXG4gIHN0YXJ0UHJvZ3JhbShvcDogQVNULlByb2dyYW0pIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnB1c2gob3BbJ3N5bWJvbHMnXSk7XG4gIH1cblxuICBlbmRQcm9ncmFtKF9vcDogbnVsbCkge1xuICAgIHRoaXMuc3ltYm9sU3RhY2sucG9wKCk7XG4gIH1cblxuICBzdGFydEJsb2NrKG9wOiBBU1QuUHJvZ3JhbSkge1xuICAgIHRoaXMuc3ltYm9sU3RhY2sucHVzaChvcFsnc3ltYm9scyddKTtcbiAgfVxuXG4gIGVuZEJsb2NrKF9vcDogbnVsbCkge1xuICAgIHRoaXMuc3ltYm9sU3RhY2sucG9wKCk7XG4gIH1cblxuICBmbHVzaEVsZW1lbnQob3A6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIHRoaXMuc3ltYm9sU3RhY2sucHVzaChvcFsnc3ltYm9scyddKTtcbiAgfVxuXG4gIGNsb3NlRWxlbWVudChfb3A6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIHRoaXMuc3ltYm9sU3RhY2sucG9wKCk7XG4gIH1cblxuICBjbG9zZUNvbXBvbmVudChfb3A6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIHRoaXMuc3ltYm9sU3RhY2sucG9wKCk7XG4gIH1cblxuICBjbG9zZUR5bmFtaWNDb21wb25lbnQoX29wOiBBU1QuRWxlbWVudE5vZGUpIHtcbiAgICB0aGlzLnN5bWJvbFN0YWNrLnBvcCgpO1xuICB9XG5cbiAgYXR0clNwbGF0KF9vcDogT3B0aW9uPEluVmFyaWFibGU+KTogT3V0T3A8J2F0dHJTcGxhdCc+IHtcbiAgICByZXR1cm4gWydhdHRyU3BsYXQnLCB0aGlzLnN5bWJvbHMuYWxsb2NhdGVCbG9jaygnYXR0cnMnKV07XG4gIH1cblxuICBnZXQob3A6IFtJblZhcmlhYmxlLCBzdHJpbmdbXV0pOiBPdXRPcDwnZ2V0JyB8ICdtYXliZUxvY2FsJz4ge1xuICAgIGxldCBbbmFtZSwgcmVzdF0gPSBvcDtcblxuICAgIGlmIChuYW1lID09PSAwKSB7XG4gICAgICByZXR1cm4gWydnZXQnLCBbMCwgcmVzdF1dO1xuICAgIH1cblxuICAgIGlmIChpc0xvY2FsKG5hbWUsIHRoaXMuc3ltYm9scykpIHtcbiAgICAgIGxldCBoZWFkID0gdGhpcy5zeW1ib2xzLmdldChuYW1lKTtcbiAgICAgIHJldHVybiBbJ2dldCcsIFtoZWFkLCByZXN0XV07XG4gICAgfSBlbHNlIGlmIChuYW1lWzBdID09PSAnQCcpIHtcbiAgICAgIGxldCBoZWFkID0gdGhpcy5zeW1ib2xzLmFsbG9jYXRlTmFtZWQobmFtZSk7XG4gICAgICByZXR1cm4gWydnZXQnLCBbaGVhZCwgcmVzdF1dO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gWydtYXliZUxvY2FsJywgW25hbWUsIC4uLnJlc3RdXTtcbiAgICB9XG4gIH1cblxuICBtYXliZUdldChvcDogW0luVmFyaWFibGUsIHN0cmluZ1tdXSk6IE91dE9wPCdnZXQnIHwgJ3Vua25vd24nIHwgJ21heWJlTG9jYWwnPiB7XG4gICAgbGV0IFtuYW1lLCByZXN0XSA9IG9wO1xuXG4gICAgaWYgKG5hbWUgPT09IDApIHtcbiAgICAgIHJldHVybiBbJ2dldCcsIFswLCByZXN0XV07XG4gICAgfVxuXG4gICAgaWYgKGlzTG9jYWwobmFtZSwgdGhpcy5zeW1ib2xzKSkge1xuICAgICAgbGV0IGhlYWQgPSB0aGlzLnN5bWJvbHMuZ2V0KG5hbWUpO1xuICAgICAgcmV0dXJuIFsnZ2V0JywgW2hlYWQsIHJlc3RdXTtcbiAgICB9IGVsc2UgaWYgKG5hbWVbMF0gPT09ICdAJykge1xuICAgICAgbGV0IGhlYWQgPSB0aGlzLnN5bWJvbHMuYWxsb2NhdGVOYW1lZChuYW1lKTtcbiAgICAgIHJldHVybiBbJ2dldCcsIFtoZWFkLCByZXN0XV07XG4gICAgfSBlbHNlIGlmIChyZXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFsndW5rbm93bicsIG5hbWVdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gWydtYXliZUxvY2FsJywgW25hbWUsIC4uLnJlc3RdXTtcbiAgICB9XG4gIH1cblxuICB5aWVsZChvcDogSW5WYXJpYWJsZSk6IE91dE9wPCd5aWVsZCc+IHtcbiAgICBpZiAob3AgPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHlpZWxkIHRvIHRoaXMnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gWyd5aWVsZCcsIHRoaXMuc3ltYm9scy5hbGxvY2F0ZUJsb2NrKG9wKV07XG4gIH1cblxuICBkZWJ1Z2dlcihfb3A6IE9wdGlvbjxJblZhcmlhYmxlW10+KTogT3V0T3A8J2RlYnVnZ2VyJz4ge1xuICAgIHJldHVybiBbJ2RlYnVnZ2VyJywgdGhpcy5zeW1ib2xzLmdldEV2YWxJbmZvKCldO1xuICB9XG5cbiAgaGFzQmxvY2sob3A6IEluVmFyaWFibGUpOiBPdXRPcDwnaGFzQmxvY2snPiB7XG4gICAgaWYgKG9wID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBoYXNCbG9jayB0aGlzJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFsnaGFzQmxvY2snLCB0aGlzLnN5bWJvbHMuYWxsb2NhdGVCbG9jayhvcCldO1xuICB9XG5cbiAgaGFzQmxvY2tQYXJhbXMob3A6IEluVmFyaWFibGUpOiBPdXRPcDwnaGFzQmxvY2tQYXJhbXMnPiB7XG4gICAgaWYgKG9wID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBoYXNCbG9ja1BhcmFtcyB0aGlzJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFsnaGFzQmxvY2tQYXJhbXMnLCB0aGlzLnN5bWJvbHMuYWxsb2NhdGVCbG9jayhvcCldO1xuICB9XG5cbiAgcGFydGlhbChfb3A6IE9wdGlvbjxJblZhcmlhYmxlW10+KTogT3V0T3A8J3BhcnRpYWwnPiB7XG4gICAgcmV0dXJuIFsncGFydGlhbCcsIHRoaXMuc3ltYm9scy5nZXRFdmFsSW5mbygpXTtcbiAgfVxuXG4gIHRleHQoX29wOiBzdHJpbmcpIHt9XG4gIGNvbW1lbnQoX29wOiBzdHJpbmcpIHt9XG4gIG9wZW5Db21wb25lbnQoX29wOiBBU1QuRWxlbWVudE5vZGUpIHt9XG4gIG9wZW5FbGVtZW50KF9vcDogQVNULkVsZW1lbnROb2RlKSB7fVxuICBvcGVuU3BsYXR0ZWRFbGVtZW50KF9vcDogQVNULkVsZW1lbnROb2RlKSB7fVxuICBzdGF0aWNBcmcoX29wOiBzdHJpbmcpIHt9XG4gIGR5bmFtaWNBcmcoX29wOiBzdHJpbmcpIHt9XG4gIHN0YXRpY0F0dHIoX29wOiBbc3RyaW5nLCBPcHRpb248c3RyaW5nPl0pIHt9XG4gIHRydXN0aW5nQXR0cihfb3A6IFtzdHJpbmcsIE9wdGlvbjxzdHJpbmc+XSkge31cbiAgZHluYW1pY0F0dHIoX29wOiBbc3RyaW5nLCBPcHRpb248c3RyaW5nPl0pIHt9XG4gIG1vZGlmaWVyKF9vcDogc3RyaW5nKSB7fVxuICBhcHBlbmQoX29wOiBib29sZWFuKSB7fVxuICBibG9jayhfb3A6IFtzdHJpbmcsIG51bWJlciwgT3B0aW9uPG51bWJlcj5dKSB7fVxuICBsaXRlcmFsKF9vcDogc3RyaW5nIHwgYm9vbGVhbiB8IG51bWJlciB8IG51bGwgfCB1bmRlZmluZWQpIHt9XG4gIGhlbHBlcihfb3A6IHN0cmluZykge31cbiAgdW5rbm93bihfb3A6IHN0cmluZykge31cbiAgbWF5YmVMb2NhbChfb3A6IHN0cmluZ1tdKSB7fVxuICBwcmVwYXJlQXJyYXkoX29wOiBudW1iZXIpIHt9XG4gIHByZXBhcmVPYmplY3QoX29wOiBudW1iZXIpIHt9XG4gIGNvbmNhdChfb3A6IG51bGwpIHt9XG59XG5cbmZ1bmN0aW9uIGlzTG9jYWwobmFtZTogc3RyaW5nLCBzeW1ib2xzOiBTeW1ib2xUYWJsZSk6IGJvb2xlYW4ge1xuICByZXR1cm4gc3ltYm9scyAmJiBzeW1ib2xzLmhhcyhuYW1lKTtcbn1cbiJdfQ==