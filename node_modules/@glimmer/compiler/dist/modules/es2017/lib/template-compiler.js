import TemplateVisitor from './template-visitor';
import JavaScriptCompiler from './javascript-compiler';
import { assert } from '@glimmer/util';
import { isLiteral, SyntaxError } from '@glimmer/syntax';
import { getAttrNamespace } from './utils';
import { SymbolAllocator } from './allocate-symbols';
function isTrustedValue(value) {
    return value.escaped !== undefined && !value.escaped;
}
export const THIS = 0;
export default class TemplateCompiler {
    constructor() {
        this.templateId = 0;
        this.templateIds = [];
        this.opcodes = [];
        this.includeMeta = false;
    }
    static compile(ast, options) {
        let templateVisitor = new TemplateVisitor();
        templateVisitor.visit(ast);
        let compiler = new TemplateCompiler();
        let opcodes = compiler.process(templateVisitor.actions);
        let symbols = new SymbolAllocator(opcodes).process();
        return JavaScriptCompiler.process(symbols, ast['symbols'], options);
    }
    process(actions) {
        actions.forEach(([name, ...args]) => {
            if (!this[name]) {
                throw new Error(`Unimplemented ${name} on TemplateCompiler`);
            }
            this[name](...args);
        });
        return this.opcodes;
    }
    startProgram([program]) {
        this.opcode(['startProgram', program], program);
    }
    endProgram() {
        this.opcode(['endProgram', null], null);
    }
    startBlock([program]) {
        this.templateId++;
        this.opcode(['startBlock', program], program);
    }
    endBlock() {
        this.templateIds.push(this.templateId - 1);
        this.opcode(['endBlock', null], null);
    }
    text([action]) {
        this.opcode(['text', action.chars], action);
    }
    comment([action]) {
        this.opcode(['comment', action.value], action);
    }
    openElement([action]) {
        let attributes = action.attributes;
        let hasSplat;
        for (let i = 0; i < attributes.length; i++) {
            let attr = attributes[i];
            if (attr.name === '...attributes') {
                hasSplat = attr;
                break;
            }
        }
        if (isDynamicComponent(action)) {
            let head, rest;
            [head, ...rest] = action.tag.split('.');
            if (head === 'this') {
                head = 0;
            }
            this.opcode(['get', [head, rest]]);
            this.opcode(['openComponent', action], action);
        } else if (isComponent(action)) {
            this.opcode(['openComponent', action], action);
        } else if (hasSplat) {
            this.opcode(['openSplattedElement', action], action);
        } else {
            this.opcode(['openElement', action], action);
        }
        let typeAttr = null;
        let attrs = action.attributes;
        for (let i = 0; i < attrs.length; i++) {
            if (attrs[i].name === 'type') {
                typeAttr = attrs[i];
                continue;
            }
            this.attribute([attrs[i]]);
        }
        if (typeAttr) {
            this.attribute([typeAttr]);
        }
        this.opcode(['flushElement', action], null);
    }
    closeElement([action]) {
        if (isDynamicComponent(action)) {
            this.opcode(['closeDynamicComponent', action], action);
        } else if (isComponent(action)) {
            this.opcode(['closeComponent', action], action);
        } else if (action.modifiers.length > 0) {
            for (let i = 0; i < action.modifiers.length; i++) {
                this.modifier([action.modifiers[i]]);
            }
            this.opcode(['closeElement', action], action);
        } else {
            this.opcode(['closeElement', action], action);
        }
    }
    attribute([action]) {
        let { name, value } = action;
        let namespace = getAttrNamespace(name);
        let isStatic = this.prepareAttributeValue(value);
        if (name.charAt(0) === '@') {
            // Arguments
            if (isStatic) {
                this.opcode(['staticArg', name], action);
            } else if (action.value.type === 'MustacheStatement') {
                this.opcode(['dynamicArg', name], action);
            } else {
                this.opcode(['dynamicArg', name], action);
            }
        } else {
            let isTrusting = isTrustedValue(value);
            if (isStatic && name === '...attributes') {
                this.opcode(['attrSplat', null], action);
            } else if (isStatic) {
                this.opcode(['staticAttr', [name, namespace]], action);
            } else if (isTrusting) {
                this.opcode(['trustingAttr', [name, namespace]], action);
            } else if (action.value.type === 'MustacheStatement') {
                this.opcode(['dynamicAttr', [name, null]], action);
            } else {
                this.opcode(['dynamicAttr', [name, namespace]], action);
            }
        }
    }
    modifier([action]) {
        assertIsSimplePath(action.path, action.loc, 'modifier');
        let { path: { parts } } = action;
        this.prepareHelper(action);
        this.opcode(['modifier', parts[0]], action);
    }
    mustache([action]) {
        let { path } = action;
        if (isLiteral(path)) {
            this.mustacheExpression(action);
            this.opcode(['append', !action.escaped], action);
        } else if (isYield(path)) {
            let to = assertValidYield(action);
            this.yield(to, action);
        } else if (isPartial(path)) {
            let params = assertValidPartial(action);
            this.partial(params, action);
        } else if (isDebugger(path)) {
            assertValidDebuggerUsage(action);
            this.debugger('debugger', action);
        } else {
            this.mustacheExpression(action);
            this.opcode(['append', !action.escaped], action);
        }
    }
    block([action /*, index, count*/]) {
        this.prepareHelper(action);
        let templateId = this.templateIds.pop();
        let inverseId = action.inverse === null ? null : this.templateIds.pop();
        this.opcode(['block', [action.path.parts[0], templateId, inverseId]], action);
    }
    /// Internal actions, not found in the original processed actions
    arg([path]) {
        let { parts: [head, ...rest] } = path;
        this.opcode(['get', [`@${head}`, rest]], path);
    }
    mustacheExpression(expr) {
        let { path } = expr;
        if (isLiteral(path)) {
            this.opcode(['literal', path.value], expr);
        } else if (isBuiltInHelper(path)) {
            this.builtInHelper(expr);
        } else if (isArg(path)) {
            this.arg([path]);
        } else if (isHelperInvocation(expr)) {
            this.prepareHelper(expr);
            this.opcode(['helper', path.parts[0]], expr);
        } else if (path.this) {
            this.opcode(['get', [0, path.parts]], expr);
        } else {
            let [head, ...parts] = path.parts;
            this.opcode(['maybeGet', [head, parts]], expr);
        }
        // } else if (isLocal(path, this.symbols)) {
        //   let [head, ...parts] = path.parts;
        //   this.opcode(['get', [head, parts]], expr);
        // } else if (isSimplePath(path)) {
        //   this.opcode(['unknown', path.parts[0]], expr);
        // } else {
        //   this.opcode(['maybeLocal', path.parts], expr);
        // }
    }
    /// Internal Syntax
    yield(to, action) {
        this.prepareParams(action.params);
        this.opcode(['yield', to], action);
    }
    debugger(_name, action) {
        this.opcode(['debugger', null], action);
    }
    hasBlock(name, action) {
        this.opcode(['hasBlock', name], action);
    }
    hasBlockParams(name, action) {
        this.opcode(['hasBlockParams', name], action);
    }
    partial(_params, action) {
        this.prepareParams(action.params);
        this.opcode(['partial', null], action);
    }
    builtInHelper(expr) {
        let { path } = expr;
        if (isHasBlock(path)) {
            let name = assertValidHasBlockUsage(expr.path.original, expr);
            this.hasBlock(name, expr);
        } else if (isHasBlockParams(path)) {
            let name = assertValidHasBlockUsage(expr.path.original, expr);
            this.hasBlockParams(name, expr);
        }
    }
    /// Expressions, invoked recursively from prepareParams and prepareHash
    SubExpression(expr) {
        if (isBuiltInHelper(expr.path)) {
            this.builtInHelper(expr);
        } else {
            this.prepareHelper(expr);
            this.opcode(['helper', expr.path.parts[0]], expr);
        }
    }
    PathExpression(expr) {
        if (expr.data) {
            this.arg([expr]);
        } else {
            let [head, ...rest] = expr.parts;
            if (expr.this) {
                this.opcode(['get', [0, expr.parts]], expr);
            } else {
                this.opcode(['get', [head, rest]], expr);
            }
        }
    }
    StringLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    BooleanLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    NumberLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    NullLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    UndefinedLiteral(action) {
        this.opcode(['literal', action.value], action);
    }
    /// Utilities
    opcode(opcode, action = null) {
        // TODO: This doesn't really work
        if (this.includeMeta && action) {
            opcode.push(this.meta(action));
        }
        this.opcodes.push(opcode);
    }
    prepareHelper(expr) {
        assertIsSimplePath(expr.path, expr.loc, 'helper');
        let { params, hash } = expr;
        this.prepareHash(hash);
        this.prepareParams(params);
    }
    prepareParams(params) {
        if (!params.length) {
            this.opcode(['literal', null], null);
            return;
        }
        for (let i = params.length - 1; i >= 0; i--) {
            let param = params[i];
            (false && assert(this[param.type], `Unimplemented ${param.type} on TemplateCompiler`));

            this[param.type](param);
        }
        this.opcode(['prepareArray', params.length], null);
    }
    prepareHash(hash) {
        let pairs = hash.pairs;
        if (!pairs.length) {
            this.opcode(['literal', null], null);
            return;
        }
        for (let i = pairs.length - 1; i >= 0; i--) {
            let { key, value } = pairs[i];
            (false && assert(this[value.type], `Unimplemented ${value.type} on TemplateCompiler`));

            this[value.type](value);
            this.opcode(['literal', key], null);
        }
        this.opcode(['prepareObject', pairs.length], null);
    }
    prepareAttributeValue(value) {
        // returns the static value if the value is static
        switch (value.type) {
            case 'TextNode':
                this.opcode(['literal', value.chars], value);
                return true;
            case 'MustacheStatement':
                this.attributeMustache([value]);
                return false;
            case 'ConcatStatement':
                this.prepareConcatParts(value.parts);
                this.opcode(['concat', null], value);
                return false;
        }
    }
    prepareConcatParts(parts) {
        for (let i = parts.length - 1; i >= 0; i--) {
            let part = parts[i];
            if (part.type === 'MustacheStatement') {
                this.attributeMustache([part]);
            } else if (part.type === 'TextNode') {
                this.opcode(['literal', part.chars], null);
            }
        }
        this.opcode(['prepareArray', parts.length], null);
    }
    attributeMustache([action]) {
        this.mustacheExpression(action);
    }
    meta(node) {
        let loc = node.loc;
        if (!loc) {
            return [];
        }
        let { source, start, end } = loc;
        return ['loc', [source || null, [start.line, start.column], [end.line, end.column]]];
    }
}
function isHelperInvocation(mustache) {
    return mustache.params && mustache.params.length > 0 || mustache.hash && mustache.hash.pairs.length > 0;
}
function isSimplePath({ parts }) {
    return parts.length === 1;
}
function isYield(path) {
    return path.original === 'yield';
}
function isPartial(path) {
    return path.original === 'partial';
}
function isDebugger(path) {
    return path.original === 'debugger';
}
function isHasBlock(path) {
    return path.original === 'has-block';
}
function isHasBlockParams(path) {
    return path.original === 'has-block-params';
}
function isBuiltInHelper(path) {
    return isHasBlock(path) || isHasBlockParams(path);
}
function isArg(path) {
    return !!path['data'];
}
function isDynamicComponent(element) {
    let open = element.tag.charAt(0);
    let [maybeLocal] = element.tag.split('.');
    let isNamedArgument = open === '@';
    let isLocal = element['symbols'].has(maybeLocal);
    let isThisPath = element.tag.indexOf('this.') === 0;
    return isLocal || isNamedArgument || isThisPath;
}
function isComponent(element) {
    let open = element.tag.charAt(0);
    let isPath = element.tag.indexOf('.') > -1;
    let isUpperCase = open === open.toUpperCase() && open !== open.toLowerCase();
    return isUpperCase && !isPath || isDynamicComponent(element);
}
function assertIsSimplePath(path, loc, context) {
    if (!isSimplePath(path)) {
        throw new SyntaxError(`\`${path.original}\` is not a valid name for a ${context} on line ${loc.start.line}.`, path.loc);
    }
}
function assertValidYield(statement) {
    let { pairs } = statement.hash;
    if (pairs.length === 1 && pairs[0].key !== 'to' || pairs.length > 1) {
        throw new SyntaxError(`yield only takes a single named argument: 'to'`, statement.loc);
    } else if (pairs.length === 1 && pairs[0].value.type !== 'StringLiteral') {
        throw new SyntaxError(`you can only yield to a literal value`, statement.loc);
    } else if (pairs.length === 0) {
        return 'default';
    } else {
        return pairs[0].value.value;
    }
}
function assertValidPartial(statement) {
    let { params, hash, escaped, loc } = statement;
    if (params && params.length !== 1) {
        throw new SyntaxError(`Partial found with no arguments. You must specify a template name. (on line ${loc.start.line})`, statement.loc);
    } else if (hash && hash.pairs.length > 0) {
        throw new SyntaxError(`partial does not take any named arguments (on line ${loc.start.line})`, statement.loc);
    } else if (!escaped) {
        throw new SyntaxError(`{{{partial ...}}} is not supported, please use {{partial ...}} instead (on line ${loc.start.line})`, statement.loc);
    }
    return params;
}
function assertValidHasBlockUsage(type, call) {
    let { params, hash, loc } = call;
    if (hash && hash.pairs.length > 0) {
        throw new SyntaxError(`${type} does not take any named arguments`, call.loc);
    }
    if (params.length === 0) {
        return 'default';
    } else if (params.length === 1) {
        let param = params[0];
        if (param.type === 'StringLiteral') {
            return param.value;
        } else {
            throw new SyntaxError(`you can only yield to a literal value (on line ${loc.start.line})`, call.loc);
        }
    } else {
        throw new SyntaxError(`${type} only takes a single positional argument (on line ${loc.start.line})`, call.loc);
    }
}
function assertValidDebuggerUsage(statement) {
    let { params, hash } = statement;
    if (hash && hash.pairs.length > 0) {
        throw new SyntaxError(`debugger does not take any named arguments`, statement.loc);
    }
    if (params.length === 0) {
        return 'default';
    } else {
        throw new SyntaxError(`debugger does not take any positional arguments`, statement.loc);
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcGxhdGUtY29tcGlsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wYWNrYWdlcy9AZ2xpbW1lci9jb21waWxlci9saWIvdGVtcGxhdGUtY29tcGlsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxBQUEyQixxQkFBTSxBQUFvQixBQUFDO0FBQzdELE9BQU8sQUFBZ0Msd0JBQU0sQUFBdUIsQUFBQztBQUNyRSxBQUFPLFNBQUUsQUFBTSxBQUFVLGNBQU0sQUFBZSxBQUFDO0FBQy9DLEFBQU8sU0FBTyxBQUFTLFdBQUUsQUFBVyxBQUFFLG1CQUFNLEFBQWlCLEFBQUM7QUFDOUQsQUFBTyxTQUFFLEFBQWdCLEFBQUUsd0JBQU0sQUFBUyxBQUFDO0FBRTNDLEFBQU8sU0FBRSxBQUFlLEFBQTRDLHVCQUFNLEFBQW9CLEFBQUM7QUFRL0YsU0FBUyxBQUFjLGVBQUMsQUFBVTtBQUNoQyxXQUFPLEFBQUssTUFBQyxBQUFPLFlBQUssQUFBUyxhQUFJLENBQUMsQUFBSyxNQUFDLEFBQU8sQUFBQyxBQUN2RDtBQUFDO0FBRUQsQUFBTSxPQUFDLE1BQU0sQUFBSSxPQUFHLEFBQUMsQUFBQztBQUV0QixBQUFNLEFBQUMsQUFBTyxxQkFBTyxBQUFnQjtBQUFyQztBQVlVLGFBQVUsYUFBRyxBQUFDLEFBQUM7QUFDZixhQUFXLGNBQWEsQUFBRSxBQUFDO0FBQzNCLGFBQU8sVUFBaUIsQUFBRSxBQUFDO0FBQzNCLGFBQVcsY0FBRyxBQUFLLEFBQUMsQUFtWTlCO0FBQUM7QUFqWkMsQUFBTSxXQUFDLEFBQU8sUUFBQyxBQUFnQixLQUFFLEFBQXdCO0FBQ3ZELFlBQUksQUFBZSxrQkFBRyxJQUFJLEFBQWUsQUFBRSxBQUFDO0FBQzVDLEFBQWUsd0JBQUMsQUFBSyxNQUFDLEFBQUcsQUFBQyxBQUFDO0FBRTNCLFlBQUksQUFBUSxXQUFHLElBQUksQUFBZ0IsQUFBRSxBQUFDO0FBQ3RDLFlBQUksQUFBTyxVQUFpQixBQUFR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SSxBQUFLLFFBQUcsQUFBTSxPQUFDLEFBQUMsQUFBQyxBQUFDO0FBQ3RCLFlBQUksQUFBSyxNQUFDLEFBQUksU0FBSyxBQUFlLGlCQUFFO0FBQ2xDLG1CQUFPLEFBQUssTUFBQyxBQUFLLEFBQUM7QUFDcEIsZUFBTTtBQUNMLGtCQUFNLElBQUksQUFBVyxBQUNuQiw4REFBa0QsQUFBRyxJQUFDLEFBQUssTUFBQyxBQUFJLElBQUcsS0FDbkUsQUFBSSxLQUFDLEFBQUcsQUFDVCxBQUFDO0FBQ0g7QUFDRixLQVZNLE1BVUE7QUFDTCxjQUFNLElBQUksQUFBVyxBQUNuQixlQUFHLEFBQUkseURBQXFELEFBQUcsSUFBQyxBQUFLLE1BQUMsQUFBSSxJQUFHLEtBQzdFLEFBQUksS0FBQyxBQUFHLEFBQ1QsQUFBQztBQUNILEFBQ0g7QUFBQztBQUVELFNBQVMsQUFBd0IseUJBQUMsQUFBZ0M7QUFDaEUsUUFBSSxFQUFFLEFBQU0sUUFBRSxBQUFJLEFBQUUsU0FBRyxBQUFTLEFBQUM7QUFFakMsUUFBSSxBQUFJLFFBQUksQUFBSSxLQUFDLEFBQUssTUFBQyxBQUFNLFNBQUcsQUFBQyxHQUFFO0FBQ2pDLGNBQU0sSUFBSSxBQUFXLEFBQUMsWUFBNEMsOENBQUUsQUFBUyxVQUFDLEFBQUcsQUFBQyxBQUFDO0FBQ3BGO0FBRUQsUUFBSSxBQUFNLE9BQUMsQUFBTSxXQUFLLEFBQUMsR0FBRTtBQUN2QixlQUFPLEFBQVMsQUFBQztBQUNsQixXQUFNO0FBQ0wsY0FBTSxJQUFJLEFBQVcsQUFBQyxZQUFpRCxtREFBRSxBQUFTLFVBQUMsQUFBRyxBQUFDLEFBQUM7QUFDekYsQUFDSDtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFRlbXBsYXRlVmlzaXRvciwgeyBBY3Rpb24gfSBmcm9tICcuL3RlbXBsYXRlLXZpc2l0b3InO1xuaW1wb3J0IEphdmFTY3JpcHRDb21waWxlciwgeyBUZW1wbGF0ZSB9IGZyb20gJy4vamF2YXNjcmlwdC1jb21waWxlcic7XG5pbXBvcnQgeyBhc3NlcnQsIE9wdGlvbiB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgQVNULCBpc0xpdGVyYWwsIFN5bnRheEVycm9yIH0gZnJvbSAnQGdsaW1tZXIvc3ludGF4JztcbmltcG9ydCB7IGdldEF0dHJOYW1lc3BhY2UgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IE9wYXF1ZSB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgU3ltYm9sQWxsb2NhdG9yLCBJbk9wIGFzIFN5bWJvbEluT3AsIE91dE9wIGFzIFN5bWJvbE91dE9wIH0gZnJvbSAnLi9hbGxvY2F0ZS1zeW1ib2xzJztcbmltcG9ydCB7IFBhdGhIZWFkIH0gZnJvbSAnLi9jb21waWxlci1vcHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBpbGVPcHRpb25zIHtcbiAgbWV0YTogT3BhcXVlO1xuICBjdXN0b21pemVDb21wb25lbnROYW1lPyh0YWc6IHN0cmluZyk6IHN0cmluZztcbn1cblxuZnVuY3Rpb24gaXNUcnVzdGVkVmFsdWUodmFsdWU6IGFueSkge1xuICByZXR1cm4gdmFsdWUuZXNjYXBlZCAhPT0gdW5kZWZpbmVkICYmICF2YWx1ZS5lc2NhcGVkO1xufVxuXG5leHBvcnQgY29uc3QgVEhJUyA9IDA7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRlbXBsYXRlQ29tcGlsZXIge1xuICBzdGF0aWMgY29tcGlsZShhc3Q6IEFTVC5Qcm9ncmFtLCBvcHRpb25zPzogQ29tcGlsZU9wdGlvbnMpOiBUZW1wbGF0ZSB7XG4gICAgbGV0IHRlbXBsYXRlVmlzaXRvciA9IG5ldyBUZW1wbGF0ZVZpc2l0b3IoKTtcbiAgICB0ZW1wbGF0ZVZpc2l0b3IudmlzaXQoYXN0KTtcblxuICAgIGxldCBjb21waWxlciA9IG5ldyBUZW1wbGF0ZUNvbXBpbGVyKCk7XG4gICAgbGV0IG9wY29kZXM6IFN5bWJvbEluT3BbXSA9IGNvbXBpbGVyLnByb2Nlc3ModGVtcGxhdGVWaXNpdG9yLmFjdGlvbnMpO1xuICAgIGxldCBzeW1ib2xzOiBTeW1ib2xPdXRPcFtdID0gbmV3IFN5bWJvbEFsbG9jYXRvcihvcGNvZGVzKS5wcm9jZXNzKCk7XG5cbiAgICByZXR1cm4gSmF2YVNjcmlwdENvbXBpbGVyLnByb2Nlc3Moc3ltYm9scywgYXN0WydzeW1ib2xzJ10sIG9wdGlvbnMpO1xuICB9XG5cbiAgcHJpdmF0ZSB0ZW1wbGF0ZUlkID0gMDtcbiAgcHJpdmF0ZSB0ZW1wbGF0ZUlkczogbnVtYmVyW10gPSBbXTtcbiAgcHJpdmF0ZSBvcGNvZGVzOiBTeW1ib2xJbk9wW10gPSBbXTtcbiAgcHJpdmF0ZSBpbmNsdWRlTWV0YSA9IGZhbHNlO1xuXG4gIHByb2Nlc3MoYWN0aW9uczogQWN0aW9uW10pOiBTeW1ib2xJbk9wW10ge1xuICAgIGFjdGlvbnMuZm9yRWFjaCgoW25hbWUsIC4uLmFyZ3NdKSA9PiB7XG4gICAgICBpZiAoIXRoaXNbbmFtZV0pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmltcGxlbWVudGVkICR7bmFtZX0gb24gVGVtcGxhdGVDb21waWxlcmApO1xuICAgICAgfVxuICAgICAgKHRoaXNbbmFtZV0gYXMgYW55KSguLi5hcmdzKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5vcGNvZGVzO1xuICB9XG5cbiAgc3RhcnRQcm9ncmFtKFtwcm9ncmFtXTogW0FTVC5Qcm9ncmFtXSkge1xuICAgIHRoaXMub3Bjb2RlKFsnc3RhcnRQcm9ncmFtJywgcHJvZ3JhbV0sIHByb2dyYW0pO1xuICB9XG5cbiAgZW5kUHJvZ3JhbSgpIHtcbiAgICB0aGlzLm9wY29kZShbJ2VuZFByb2dyYW0nLCBudWxsXSwgbnVsbCk7XG4gIH1cblxuICBzdGFydEJsb2NrKFtwcm9ncmFtXTogW0FTVC5Qcm9ncmFtXSkge1xuICAgIHRoaXMudGVtcGxhdGVJZCsrO1xuICAgIHRoaXMub3Bjb2RlKFsnc3RhcnRCbG9jaycsIHByb2dyYW1dLCBwcm9ncmFtKTtcbiAgfVxuXG4gIGVuZEJsb2NrKCkge1xuICAgIHRoaXMudGVtcGxhdGVJZHMucHVzaCh0aGlzLnRlbXBsYXRlSWQgLSAxKTtcbiAgICB0aGlzLm9wY29kZShbJ2VuZEJsb2NrJywgbnVsbF0sIG51bGwpO1xuICB9XG5cbiAgdGV4dChbYWN0aW9uXTogW0FTVC5UZXh0Tm9kZV0pIHtcbiAgICB0aGlzLm9wY29kZShbJ3RleHQnLCBhY3Rpb24uY2hhcnNdLCBhY3Rpb24pO1xuICB9XG5cbiAgY29tbWVudChbYWN0aW9uXTogW0FTVC5Db21tZW50U3RhdGVtZW50XSkge1xuICAgIHRoaXMub3Bjb2RlKFsnY29tbWVudCcsIGFjdGlvbi52YWx1ZV0sIGFjdGlvbik7XG4gIH1cblxuICBvcGVuRWxlbWVudChbYWN0aW9uXTogW0FTVC5FbGVtZW50Tm9kZV0pIHtcbiAgICBsZXQgYXR0cmlidXRlcyA9IGFjdGlvbi5hdHRyaWJ1dGVzO1xuICAgIGxldCBoYXNTcGxhdDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGF0dHIgPSBhdHRyaWJ1dGVzW2ldO1xuICAgICAgaWYgKGF0dHIubmFtZSA9PT0gJy4uLmF0dHJpYnV0ZXMnKSB7XG4gICAgICAgIGhhc1NwbGF0ID0gYXR0cjtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGlzRHluYW1pY0NvbXBvbmVudChhY3Rpb24pKSB7XG4gICAgICBsZXQgaGVhZDogUGF0aEhlYWQsIHJlc3Q6IHN0cmluZ1tdO1xuICAgICAgW2hlYWQsIC4uLnJlc3RdID0gYWN0aW9uLnRhZy5zcGxpdCgnLicpO1xuICAgICAgaWYgKGhlYWQgPT09ICd0aGlzJykge1xuICAgICAgICBoZWFkID0gMDtcbiAgICAgIH1cbiAgICAgIHRoaXMub3Bjb2RlKFsnZ2V0JywgW2hlYWQsIHJlc3RdXSk7XG4gICAgICB0aGlzLm9wY29kZShbJ29wZW5Db21wb25lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoaXNDb21wb25lbnQoYWN0aW9uKSkge1xuICAgICAgdGhpcy5vcGNvZGUoWydvcGVuQ29tcG9uZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKGhhc1NwbGF0KSB7XG4gICAgICB0aGlzLm9wY29kZShbJ29wZW5TcGxhdHRlZEVsZW1lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wY29kZShbJ29wZW5FbGVtZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9XG5cbiAgICBsZXQgdHlwZUF0dHI6IE9wdGlvbjxBU1QuQXR0ck5vZGU+ID0gbnVsbDtcbiAgICBsZXQgYXR0cnMgPSBhY3Rpb24uYXR0cmlidXRlcztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYXR0cnNbaV0ubmFtZSA9PT0gJ3R5cGUnKSB7XG4gICAgICAgIHR5cGVBdHRyID0gYXR0cnNbaV07XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5hdHRyaWJ1dGUoW2F0dHJzW2ldXSk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVBdHRyKSB7XG4gICAgICB0aGlzLmF0dHJpYnV0ZShbdHlwZUF0dHJdKTtcbiAgICB9XG5cbiAgICB0aGlzLm9wY29kZShbJ2ZsdXNoRWxlbWVudCcsIGFjdGlvbl0sIG51bGwpO1xuICB9XG5cbiAgY2xvc2VFbGVtZW50KFthY3Rpb25dOiBbQVNULkVsZW1lbnROb2RlXSkge1xuICAgIGlmIChpc0R5bmFtaWNDb21wb25lbnQoYWN0aW9uKSkge1xuICAgICAgdGhpcy5vcGNvZGUoWydjbG9zZUR5bmFtaWNDb21wb25lbnQnLCBhY3Rpb25dLCBhY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoaXNDb21wb25lbnQoYWN0aW9uKSkge1xuICAgICAgdGhpcy5vcGNvZGUoWydjbG9zZUNvbXBvbmVudCcsIGFjdGlvbl0sIGFjdGlvbik7XG4gICAgfSBlbHNlIGlmIChhY3Rpb24ubW9kaWZpZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWN0aW9uLm1vZGlmaWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICB0aGlzLm1vZGlmaWVyKFthY3Rpb24ubW9kaWZpZXJzW2ldXSk7XG4gICAgICB9XG4gICAgICB0aGlzLm9wY29kZShbJ2Nsb3NlRWxlbWVudCcsIGFjdGlvbl0sIGFjdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3Bjb2RlKFsnY2xvc2VFbGVtZW50JywgYWN0aW9uXSwgYWN0aW9uKTtcbiAgICB9XG4gIH1cblxuICBhdHRyaWJ1dGUoW2FjdGlvbl06IFtBU1QuQXR0ck5vZGVdKSB7XG4gICAgbGV0IHsgbmFtZSwgdmFsdWUgfSA9IGFjdGlvbjtcblxuICAgIGxldCBuYW1lc3BhY2UgPSBnZXRBdHRyTmFtZXNwYWNlKG5hbWUpO1xuXG4gICAgbGV0IGlzU3RhdGljID0gdGhpcy5wcmVwYXJlQXR0cmlidXRlVmFsdWUodmFsdWUpO1xuXG4gICAgaWYgKG5hbWUuY2hhckF0KDApID09PSAnQCcpIHtcbiAgICAgIC8vIEFyZ3VtZW50c1xuICAgICAgaWYgKGlzU3RhdGljKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnc3RhdGljQXJnJywgbmFtZV0sIGFjdGlvbik7XG4gICAgICB9IGVsc2UgaWYgKGFjdGlvbi52YWx1ZS50eXBlID09PSAnTXVzdGFjaGVTdGF0ZW1lbnQnKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnZHluYW1pY0FyZycsIG5hbWVdLCBhY3Rpb24pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydkeW5hbWljQXJnJywgbmFtZV0sIGFjdGlvbik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBpc1RydXN0aW5nID0gaXNUcnVzdGVkVmFsdWUodmFsdWUpO1xuXG4gICAgICBpZiAoaXNTdGF0aWMgJiYgbmFtZSA9PT0gJy4uLmF0dHJpYnV0ZXMnKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnYXR0clNwbGF0JywgbnVsbF0sIGFjdGlvbik7XG4gICAgICB9IGVsc2UgaWYgKGlzU3RhdGljKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnc3RhdGljQXR0cicsIFtuYW1lLCBuYW1lc3BhY2VdXSwgYWN0aW9uKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNUcnVzdGluZykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ3RydXN0aW5nQXR0cicsIFtuYW1lLCBuYW1lc3BhY2VdXSwgYWN0aW9uKTtcbiAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLnZhbHVlLnR5cGUgPT09ICdNdXN0YWNoZVN0YXRlbWVudCcpIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydkeW5hbWljQXR0cicsIFtuYW1lLCBudWxsXV0sIGFjdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2R5bmFtaWNBdHRyJywgW25hbWUsIG5hbWVzcGFjZV1dLCBhY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG1vZGlmaWVyKFthY3Rpb25dOiBbQVNULkVsZW1lbnRNb2RpZmllclN0YXRlbWVudF0pIHtcbiAgICBhc3NlcnRJc1NpbXBsZVBhdGgoYWN0aW9uLnBhdGgsIGFjdGlvbi5sb2MsICdtb2RpZmllcicpO1xuXG4gICAgbGV0IHtcbiAgICAgIHBhdGg6IHsgcGFydHMgfSxcbiAgICB9ID0gYWN0aW9uO1xuXG4gICAgdGhpcy5wcmVwYXJlSGVscGVyKGFjdGlvbik7XG4gICAgdGhpcy5vcGNvZGUoWydtb2RpZmllcicsIHBhcnRzWzBdXSwgYWN0aW9uKTtcbiAgfVxuXG4gIG11c3RhY2hlKFthY3Rpb25dOiBbQVNULk11c3RhY2hlU3RhdGVtZW50XSkge1xuICAgIGxldCB7IHBhdGggfSA9IGFjdGlvbjtcblxuICAgIGlmIChpc0xpdGVyYWwocGF0aCkpIHtcbiAgICAgIHRoaXMubXVzdGFjaGVFeHByZXNzaW9uKGFjdGlvbik7XG4gICAgICB0aGlzLm9wY29kZShbJ2FwcGVuZCcsICFhY3Rpb24uZXNjYXBlZF0sIGFjdGlvbik7XG4gICAgfSBlbHNlIGlmIChpc1lpZWxkKHBhdGgpKSB7XG4gICAgICBsZXQgdG8gPSBhc3NlcnRWYWxpZFlpZWxkKGFjdGlvbik7XG4gICAgICB0aGlzLnlpZWxkKHRvLCBhY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoaXNQYXJ0aWFsKHBhdGgpKSB7XG4gICAgICBsZXQgcGFyYW1zID0gYXNzZXJ0VmFsaWRQYXJ0aWFsKGFjdGlvbik7XG4gICAgICB0aGlzLnBhcnRpYWwocGFyYW1zLCBhY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoaXNEZWJ1Z2dlcihwYXRoKSkge1xuICAgICAgYXNzZXJ0VmFsaWREZWJ1Z2dlclVzYWdlKGFjdGlvbik7XG4gICAgICB0aGlzLmRlYnVnZ2VyKCdkZWJ1Z2dlcicsIGFjdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubXVzdGFjaGVFeHByZXNzaW9uKGFjdGlvbik7XG4gICAgICB0aGlzLm9wY29kZShbJ2FwcGVuZCcsICFhY3Rpb24uZXNjYXBlZF0sIGFjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgYmxvY2soW2FjdGlvbiAvKiwgaW5kZXgsIGNvdW50Ki9dOiBbQVNULkJsb2NrU3RhdGVtZW50XSkge1xuICAgIHRoaXMucHJlcGFyZUhlbHBlcihhY3Rpb24pO1xuICAgIGxldCB0ZW1wbGF0ZUlkID0gdGhpcy50ZW1wbGF0ZUlkcy5wb3AoKSE7XG4gICAgbGV0IGludmVyc2VJZCA9IGFjdGlvbi5pbnZlcnNlID09PSBudWxsID8gbnVsbCA6IHRoaXMudGVtcGxhdGVJZHMucG9wKCkhO1xuICAgIHRoaXMub3Bjb2RlKFsnYmxvY2snLCBbYWN0aW9uLnBhdGgucGFydHNbMF0sIHRlbXBsYXRlSWQsIGludmVyc2VJZF1dLCBhY3Rpb24pO1xuICB9XG5cbiAgLy8vIEludGVybmFsIGFjdGlvbnMsIG5vdCBmb3VuZCBpbiB0aGUgb3JpZ2luYWwgcHJvY2Vzc2VkIGFjdGlvbnNcblxuICBhcmcoW3BhdGhdOiBbQVNULlBhdGhFeHByZXNzaW9uXSkge1xuICAgIGxldCB7XG4gICAgICBwYXJ0czogW2hlYWQsIC4uLnJlc3RdLFxuICAgIH0gPSBwYXRoO1xuICAgIHRoaXMub3Bjb2RlKFsnZ2V0JywgW2BAJHtoZWFkfWAsIHJlc3RdXSwgcGF0aCk7XG4gIH1cblxuICBtdXN0YWNoZUV4cHJlc3Npb24oZXhwcjogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgbGV0IHsgcGF0aCB9ID0gZXhwcjtcblxuICAgIGlmIChpc0xpdGVyYWwocGF0aCkpIHtcbiAgICAgIHRoaXMub3Bjb2RlKFsnbGl0ZXJhbCcsIHBhdGgudmFsdWVdLCBleHByKTtcbiAgICB9IGVsc2UgaWYgKGlzQnVpbHRJbkhlbHBlcihwYXRoKSkge1xuICAgICAgdGhpcy5idWlsdEluSGVscGVyKGV4cHIgYXMgQVNULkNhbGwpO1xuICAgIH0gZWxzZSBpZiAoaXNBcmcocGF0aCkpIHtcbiAgICAgIHRoaXMuYXJnKFtwYXRoXSk7XG4gICAgfSBlbHNlIGlmIChpc0hlbHBlckludm9jYXRpb24oZXhwcikpIHtcbiAgICAgIHRoaXMucHJlcGFyZUhlbHBlcihleHByKTtcbiAgICAgIHRoaXMub3Bjb2RlKFsnaGVscGVyJywgcGF0aC5wYXJ0c1swXV0sIGV4cHIpO1xuICAgIH0gZWxzZSBpZiAocGF0aC50aGlzKSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2dldCcsIFswLCBwYXRoLnBhcnRzXV0sIGV4cHIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgW2hlYWQsIC4uLnBhcnRzXSA9IHBhdGgucGFydHM7XG4gICAgICB0aGlzLm9wY29kZShbJ21heWJlR2V0JywgW2hlYWQsIHBhcnRzXV0sIGV4cHIpO1xuICAgIH1cblxuICAgIC8vIH0gZWxzZSBpZiAoaXNMb2NhbChwYXRoLCB0aGlzLnN5bWJvbHMpKSB7XG4gICAgLy8gICBsZXQgW2hlYWQsIC4uLnBhcnRzXSA9IHBhdGgucGFydHM7XG4gICAgLy8gICB0aGlzLm9wY29kZShbJ2dldCcsIFtoZWFkLCBwYXJ0c11dLCBleHByKTtcbiAgICAvLyB9IGVsc2UgaWYgKGlzU2ltcGxlUGF0aChwYXRoKSkge1xuICAgIC8vICAgdGhpcy5vcGNvZGUoWyd1bmtub3duJywgcGF0aC5wYXJ0c1swXV0sIGV4cHIpO1xuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICB0aGlzLm9wY29kZShbJ21heWJlTG9jYWwnLCBwYXRoLnBhcnRzXSwgZXhwcik7XG4gICAgLy8gfVxuICB9XG5cbiAgLy8vIEludGVybmFsIFN5bnRheFxuXG4gIHlpZWxkKHRvOiBzdHJpbmcsIGFjdGlvbjogQVNULk11c3RhY2hlU3RhdGVtZW50KSB7XG4gICAgdGhpcy5wcmVwYXJlUGFyYW1zKGFjdGlvbi5wYXJhbXMpO1xuICAgIHRoaXMub3Bjb2RlKFsneWllbGQnLCB0b10sIGFjdGlvbik7XG4gIH1cblxuICBkZWJ1Z2dlcihfbmFtZTogc3RyaW5nLCBhY3Rpb246IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICAgIHRoaXMub3Bjb2RlKFsnZGVidWdnZXInLCBudWxsXSwgYWN0aW9uKTtcbiAgfVxuXG4gIGhhc0Jsb2NrKG5hbWU6IHN0cmluZywgYWN0aW9uOiBBU1QuQ2FsbCkge1xuICAgIHRoaXMub3Bjb2RlKFsnaGFzQmxvY2snLCBuYW1lXSwgYWN0aW9uKTtcbiAgfVxuXG4gIGhhc0Jsb2NrUGFyYW1zKG5hbWU6IHN0cmluZywgYWN0aW9uOiBBU1QuQ2FsbCkge1xuICAgIHRoaXMub3Bjb2RlKFsnaGFzQmxvY2tQYXJhbXMnLCBuYW1lXSwgYWN0aW9uKTtcbiAgfVxuXG4gIHBhcnRpYWwoX3BhcmFtczogQVNULkV4cHJlc3Npb25bXSwgYWN0aW9uOiBBU1QuTXVzdGFjaGVTdGF0ZW1lbnQpIHtcbiAgICB0aGlzLnByZXBhcmVQYXJhbXMoYWN0aW9uLnBhcmFtcyk7XG4gICAgdGhpcy5vcGNvZGUoWydwYXJ0aWFsJywgbnVsbF0sIGFjdGlvbik7XG4gIH1cblxuICBidWlsdEluSGVscGVyKGV4cHI6IEFTVC5DYWxsKSB7XG4gICAgbGV0IHsgcGF0aCB9ID0gZXhwcjtcbiAgICBpZiAoaXNIYXNCbG9jayhwYXRoKSkge1xuICAgICAgbGV0IG5hbWUgPSBhc3NlcnRWYWxpZEhhc0Jsb2NrVXNhZ2UoZXhwci5wYXRoLm9yaWdpbmFsLCBleHByKTtcbiAgICAgIHRoaXMuaGFzQmxvY2sobmFtZSwgZXhwcik7XG4gICAgfSBlbHNlIGlmIChpc0hhc0Jsb2NrUGFyYW1zKHBhdGgpKSB7XG4gICAgICBsZXQgbmFtZSA9IGFzc2VydFZhbGlkSGFzQmxvY2tVc2FnZShleHByLnBhdGgub3JpZ2luYWwsIGV4cHIpO1xuICAgICAgdGhpcy5oYXNCbG9ja1BhcmFtcyhuYW1lLCBleHByKTtcbiAgICB9XG4gIH1cblxuICAvLy8gRXhwcmVzc2lvbnMsIGludm9rZWQgcmVjdXJzaXZlbHkgZnJvbSBwcmVwYXJlUGFyYW1zIGFuZCBwcmVwYXJlSGFzaFxuXG4gIFN1YkV4cHJlc3Npb24oZXhwcjogQVNULlN1YkV4cHJlc3Npb24pIHtcbiAgICBpZiAoaXNCdWlsdEluSGVscGVyKGV4cHIucGF0aCkpIHtcbiAgICAgIHRoaXMuYnVpbHRJbkhlbHBlcihleHByKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wcmVwYXJlSGVscGVyKGV4cHIpO1xuICAgICAgdGhpcy5vcGNvZGUoWydoZWxwZXInLCBleHByLnBhdGgucGFydHNbMF1dLCBleHByKTtcbiAgICB9XG4gIH1cblxuICBQYXRoRXhwcmVzc2lvbihleHByOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgICBpZiAoZXhwci5kYXRhKSB7XG4gICAgICB0aGlzLmFyZyhbZXhwcl0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgW2hlYWQsIC4uLnJlc3RdID0gZXhwci5wYXJ0cztcblxuICAgICAgaWYgKGV4cHIudGhpcykge1xuICAgICAgICB0aGlzLm9wY29kZShbJ2dldCcsIFswLCBleHByLnBhcnRzXV0sIGV4cHIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydnZXQnLCBbaGVhZCwgcmVzdF1dLCBleHByKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBTdHJpbmdMaXRlcmFsKGFjdGlvbjogQVNULlN0cmluZ0xpdGVyYWwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBhY3Rpb24udmFsdWVdLCBhY3Rpb24pO1xuICB9XG5cbiAgQm9vbGVhbkxpdGVyYWwoYWN0aW9uOiBBU1QuQm9vbGVhbkxpdGVyYWwpIHtcbiAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBhY3Rpb24udmFsdWVdLCBhY3Rpb24pO1xuICB9XG5cbiAgTnVtYmVyTGl0ZXJhbChhY3Rpb246IEFTVC5OdW1iZXJMaXRlcmFsKSB7XG4gICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgYWN0aW9uLnZhbHVlXSwgYWN0aW9uKTtcbiAgfVxuXG4gIE51bGxMaXRlcmFsKGFjdGlvbjogQVNULk51bGxMaXRlcmFsKSB7XG4gICAgdGhpcy5vcGNvZGUoWydsaXRlcmFsJywgYWN0aW9uLnZhbHVlXSwgYWN0aW9uKTtcbiAgfVxuXG4gIFVuZGVmaW5lZExpdGVyYWwoYWN0aW9uOiBBU1QuVW5kZWZpbmVkTGl0ZXJhbCkge1xuICAgIHRoaXMub3Bjb2RlKFsnbGl0ZXJhbCcsIGFjdGlvbi52YWx1ZV0sIGFjdGlvbik7XG4gIH1cblxuICAvLy8gVXRpbGl0aWVzXG5cbiAgb3Bjb2RlPE8gZXh0ZW5kcyBTeW1ib2xJbk9wPihvcGNvZGU6IE8sIGFjdGlvbjogT3B0aW9uPEFTVC5CYXNlTm9kZT4gPSBudWxsKSB7XG4gICAgLy8gVE9ETzogVGhpcyBkb2Vzbid0IHJlYWxseSB3b3JrXG4gICAgaWYgKHRoaXMuaW5jbHVkZU1ldGEgJiYgYWN0aW9uKSB7XG4gICAgICAob3Bjb2RlIGFzIGFueSkucHVzaCh0aGlzLm1ldGEoYWN0aW9uKSk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGVzLnB1c2gob3Bjb2RlKTtcbiAgfVxuXG4gIHByZXBhcmVIZWxwZXIoZXhwcjogQVNULkNhbGwpIHtcbiAgICBhc3NlcnRJc1NpbXBsZVBhdGgoZXhwci5wYXRoLCBleHByLmxvYywgJ2hlbHBlcicpO1xuXG4gICAgbGV0IHsgcGFyYW1zLCBoYXNoIH0gPSBleHByO1xuXG4gICAgdGhpcy5wcmVwYXJlSGFzaChoYXNoKTtcbiAgICB0aGlzLnByZXBhcmVQYXJhbXMocGFyYW1zKTtcbiAgfVxuXG4gIHByZXBhcmVQYXJhbXMocGFyYW1zOiBBU1QuRXhwcmVzc2lvbltdKSB7XG4gICAgaWYgKCFwYXJhbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBudWxsXSwgbnVsbCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IHBhcmFtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgbGV0IHBhcmFtID0gcGFyYW1zW2ldO1xuXG4gICAgICBhc3NlcnQodGhpc1twYXJhbS50eXBlXSwgYFVuaW1wbGVtZW50ZWQgJHtwYXJhbS50eXBlfSBvbiBUZW1wbGF0ZUNvbXBpbGVyYCk7XG4gICAgICAodGhpc1twYXJhbS50eXBlXSBhcyBhbnkpKHBhcmFtKTtcbiAgICB9XG5cbiAgICB0aGlzLm9wY29kZShbJ3ByZXBhcmVBcnJheScsIHBhcmFtcy5sZW5ndGhdLCBudWxsKTtcbiAgfVxuXG4gIHByZXBhcmVIYXNoKGhhc2g6IEFTVC5IYXNoKSB7XG4gICAgbGV0IHBhaXJzID0gaGFzaC5wYWlycztcblxuICAgIGlmICghcGFpcnMubGVuZ3RoKSB7XG4gICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBudWxsXSwgbnVsbCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IHBhaXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBsZXQgeyBrZXksIHZhbHVlIH0gPSBwYWlyc1tpXTtcblxuICAgICAgYXNzZXJ0KHRoaXNbdmFsdWUudHlwZV0sIGBVbmltcGxlbWVudGVkICR7dmFsdWUudHlwZX0gb24gVGVtcGxhdGVDb21waWxlcmApO1xuICAgICAgKHRoaXNbdmFsdWUudHlwZV0gYXMgYW55KSh2YWx1ZSk7XG4gICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCBrZXldLCBudWxsKTtcbiAgICB9XG5cbiAgICB0aGlzLm9wY29kZShbJ3ByZXBhcmVPYmplY3QnLCBwYWlycy5sZW5ndGhdLCBudWxsKTtcbiAgfVxuXG4gIHByZXBhcmVBdHRyaWJ1dGVWYWx1ZSh2YWx1ZTogQVNULkF0dHJOb2RlWyd2YWx1ZSddKSB7XG4gICAgLy8gcmV0dXJucyB0aGUgc3RhdGljIHZhbHVlIGlmIHRoZSB2YWx1ZSBpcyBzdGF0aWNcblxuICAgIHN3aXRjaCAodmFsdWUudHlwZSkge1xuICAgICAgY2FzZSAnVGV4dE5vZGUnOlxuICAgICAgICB0aGlzLm9wY29kZShbJ2xpdGVyYWwnLCB2YWx1ZS5jaGFyc10sIHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICBjYXNlICdNdXN0YWNoZVN0YXRlbWVudCc6XG4gICAgICAgIHRoaXMuYXR0cmlidXRlTXVzdGFjaGUoW3ZhbHVlXSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIGNhc2UgJ0NvbmNhdFN0YXRlbWVudCc6XG4gICAgICAgIHRoaXMucHJlcGFyZUNvbmNhdFBhcnRzKHZhbHVlLnBhcnRzKTtcbiAgICAgICAgdGhpcy5vcGNvZGUoWydjb25jYXQnLCBudWxsXSwgdmFsdWUpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJlcGFyZUNvbmNhdFBhcnRzKHBhcnRzOiBBU1QuQ29uY2F0U3RhdGVtZW50WydwYXJ0cyddKSB7XG4gICAgZm9yIChsZXQgaSA9IHBhcnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBsZXQgcGFydCA9IHBhcnRzW2ldO1xuXG4gICAgICBpZiAocGFydC50eXBlID09PSAnTXVzdGFjaGVTdGF0ZW1lbnQnKSB7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlTXVzdGFjaGUoW3BhcnRdKTtcbiAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlID09PSAnVGV4dE5vZGUnKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKFsnbGl0ZXJhbCcsIHBhcnQuY2hhcnNdLCBudWxsKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLm9wY29kZShbJ3ByZXBhcmVBcnJheScsIHBhcnRzLmxlbmd0aF0sIG51bGwpO1xuICB9XG5cbiAgYXR0cmlidXRlTXVzdGFjaGUoW2FjdGlvbl06IFtBU1QuTXVzdGFjaGVTdGF0ZW1lbnRdKSB7XG4gICAgdGhpcy5tdXN0YWNoZUV4cHJlc3Npb24oYWN0aW9uKTtcbiAgfVxuXG4gIG1ldGEobm9kZTogQVNULkJhc2VOb2RlKSB7XG4gICAgbGV0IGxvYyA9IG5vZGUubG9jO1xuICAgIGlmICghbG9jKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgbGV0IHsgc291cmNlLCBzdGFydCwgZW5kIH0gPSBsb2M7XG4gICAgcmV0dXJuIFsnbG9jJywgW3NvdXJjZSB8fCBudWxsLCBbc3RhcnQubGluZSwgc3RhcnQuY29sdW1uXSwgW2VuZC5saW5lLCBlbmQuY29sdW1uXV1dO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzSGVscGVySW52b2NhdGlvbihcbiAgbXVzdGFjaGU6IEFTVC5NdXN0YWNoZVN0YXRlbWVudFxuKTogbXVzdGFjaGUgaXMgQVNULk11c3RhY2hlU3RhdGVtZW50ICYgeyBwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24gfSB7XG4gIHJldHVybiAoXG4gICAgKG11c3RhY2hlLnBhcmFtcyAmJiBtdXN0YWNoZS5wYXJhbXMubGVuZ3RoID4gMCkgfHxcbiAgICAobXVzdGFjaGUuaGFzaCAmJiBtdXN0YWNoZS5oYXNoLnBhaXJzLmxlbmd0aCA+IDApXG4gICk7XG59XG5cbmZ1bmN0aW9uIGlzU2ltcGxlUGF0aCh7IHBhcnRzIH06IEFTVC5QYXRoRXhwcmVzc2lvbik6IGJvb2xlYW4ge1xuICByZXR1cm4gcGFydHMubGVuZ3RoID09PSAxO1xufVxuXG5mdW5jdGlvbiBpc1lpZWxkKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbikge1xuICByZXR1cm4gcGF0aC5vcmlnaW5hbCA9PT0gJ3lpZWxkJztcbn1cblxuZnVuY3Rpb24gaXNQYXJ0aWFsKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbikge1xuICByZXR1cm4gcGF0aC5vcmlnaW5hbCA9PT0gJ3BhcnRpYWwnO1xufVxuXG5mdW5jdGlvbiBpc0RlYnVnZ2VyKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbikge1xuICByZXR1cm4gcGF0aC5vcmlnaW5hbCA9PT0gJ2RlYnVnZ2VyJztcbn1cblxuZnVuY3Rpb24gaXNIYXNCbG9jayhwYXRoOiBBU1QuUGF0aEV4cHJlc3Npb24pIHtcbiAgcmV0dXJuIHBhdGgub3JpZ2luYWwgPT09ICdoYXMtYmxvY2snO1xufVxuXG5mdW5jdGlvbiBpc0hhc0Jsb2NrUGFyYW1zKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbikge1xuICByZXR1cm4gcGF0aC5vcmlnaW5hbCA9PT0gJ2hhcy1ibG9jay1wYXJhbXMnO1xufVxuXG5mdW5jdGlvbiBpc0J1aWx0SW5IZWxwZXIocGF0aDogQVNULlBhdGhFeHByZXNzaW9uKSB7XG4gIHJldHVybiBpc0hhc0Jsb2NrKHBhdGgpIHx8IGlzSGFzQmxvY2tQYXJhbXMocGF0aCk7XG59XG5cbmZ1bmN0aW9uIGlzQXJnKHBhdGg6IEFTVC5QYXRoRXhwcmVzc2lvbik6IGJvb2xlYW4ge1xuICByZXR1cm4gISFwYXRoWydkYXRhJ107XG59XG5cbmZ1bmN0aW9uIGlzRHluYW1pY0NvbXBvbmVudChlbGVtZW50OiBBU1QuRWxlbWVudE5vZGUpOiBib29sZWFuIHtcbiAgbGV0IG9wZW4gPSBlbGVtZW50LnRhZy5jaGFyQXQoMCk7XG5cbiAgbGV0IFttYXliZUxvY2FsXSA9IGVsZW1lbnQudGFnLnNwbGl0KCcuJyk7XG4gIGxldCBpc05hbWVkQXJndW1lbnQgPSBvcGVuID09PSAnQCc7XG4gIGxldCBpc0xvY2FsID0gZWxlbWVudFsnc3ltYm9scyddLmhhcyhtYXliZUxvY2FsKTtcbiAgbGV0IGlzVGhpc1BhdGggPSBlbGVtZW50LnRhZy5pbmRleE9mKCd0aGlzLicpID09PSAwO1xuXG4gIHJldHVybiBpc0xvY2FsIHx8IGlzTmFtZWRBcmd1bWVudCB8fCBpc1RoaXNQYXRoO1xufVxuXG5mdW5jdGlvbiBpc0NvbXBvbmVudChlbGVtZW50OiBBU1QuRWxlbWVudE5vZGUpOiBib29sZWFuIHtcbiAgbGV0IG9wZW4gPSBlbGVtZW50LnRhZy5jaGFyQXQoMCk7XG4gIGxldCBpc1BhdGggPSBlbGVtZW50LnRhZy5pbmRleE9mKCcuJykgPiAtMTtcblxuICBsZXQgaXNVcHBlckNhc2UgPSBvcGVuID09PSBvcGVuLnRvVXBwZXJDYXNlKCkgJiYgb3BlbiAhPT0gb3Blbi50b0xvd2VyQ2FzZSgpO1xuXG4gIHJldHVybiAoaXNVcHBlckNhc2UgJiYgIWlzUGF0aCkgfHwgaXNEeW5hbWljQ29tcG9uZW50KGVsZW1lbnQpO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRJc1NpbXBsZVBhdGgocGF0aDogQVNULlBhdGhFeHByZXNzaW9uLCBsb2M6IEFTVC5Tb3VyY2VMb2NhdGlvbiwgY29udGV4dDogc3RyaW5nKSB7XG4gIGlmICghaXNTaW1wbGVQYXRoKHBhdGgpKSB7XG4gICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKFxuICAgICAgYFxcYCR7cGF0aC5vcmlnaW5hbH1cXGAgaXMgbm90IGEgdmFsaWQgbmFtZSBmb3IgYSAke2NvbnRleHR9IG9uIGxpbmUgJHtsb2Muc3RhcnQubGluZX0uYCxcbiAgICAgIHBhdGgubG9jXG4gICAgKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRWYWxpZFlpZWxkKHN0YXRlbWVudDogQVNULk11c3RhY2hlU3RhdGVtZW50KTogc3RyaW5nIHtcbiAgbGV0IHsgcGFpcnMgfSA9IHN0YXRlbWVudC5oYXNoO1xuXG4gIGlmICgocGFpcnMubGVuZ3RoID09PSAxICYmIHBhaXJzWzBdLmtleSAhPT0gJ3RvJykgfHwgcGFpcnMubGVuZ3RoID4gMSkge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihgeWllbGQgb25seSB0YWtlcyBhIHNpbmdsZSBuYW1lZCBhcmd1bWVudDogJ3RvJ2AsIHN0YXRlbWVudC5sb2MpO1xuICB9IGVsc2UgaWYgKHBhaXJzLmxlbmd0aCA9PT0gMSAmJiBwYWlyc1swXS52YWx1ZS50eXBlICE9PSAnU3RyaW5nTGl0ZXJhbCcpIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYHlvdSBjYW4gb25seSB5aWVsZCB0byBhIGxpdGVyYWwgdmFsdWVgLCBzdGF0ZW1lbnQubG9jKTtcbiAgfSBlbHNlIGlmIChwYWlycy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gJ2RlZmF1bHQnO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAocGFpcnNbMF0udmFsdWUgYXMgQVNULlN0cmluZ0xpdGVyYWwpLnZhbHVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFzc2VydFZhbGlkUGFydGlhbChzdGF0ZW1lbnQ6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkgLyogOiBleHByICovIHtcbiAgbGV0IHsgcGFyYW1zLCBoYXNoLCBlc2NhcGVkLCBsb2MgfSA9IHN0YXRlbWVudDtcblxuICBpZiAocGFyYW1zICYmIHBhcmFtcy5sZW5ndGggIT09IDEpIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICBgUGFydGlhbCBmb3VuZCB3aXRoIG5vIGFyZ3VtZW50cy4gWW91IG11c3Qgc3BlY2lmeSBhIHRlbXBsYXRlIG5hbWUuIChvbiBsaW5lICR7XG4gICAgICAgIGxvYy5zdGFydC5saW5lXG4gICAgICB9KWAsXG4gICAgICBzdGF0ZW1lbnQubG9jXG4gICAgKTtcbiAgfSBlbHNlIGlmIChoYXNoICYmIGhhc2gucGFpcnMubGVuZ3RoID4gMCkge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcbiAgICAgIGBwYXJ0aWFsIGRvZXMgbm90IHRha2UgYW55IG5hbWVkIGFyZ3VtZW50cyAob24gbGluZSAke2xvYy5zdGFydC5saW5lfSlgLFxuICAgICAgc3RhdGVtZW50LmxvY1xuICAgICk7XG4gIH0gZWxzZSBpZiAoIWVzY2FwZWQpIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICBge3t7cGFydGlhbCAuLi59fX0gaXMgbm90IHN1cHBvcnRlZCwgcGxlYXNlIHVzZSB7e3BhcnRpYWwgLi4ufX0gaW5zdGVhZCAob24gbGluZSAke1xuICAgICAgICBsb2Muc3RhcnQubGluZVxuICAgICAgfSlgLFxuICAgICAgc3RhdGVtZW50LmxvY1xuICAgICk7XG4gIH1cblxuICByZXR1cm4gcGFyYW1zO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRWYWxpZEhhc0Jsb2NrVXNhZ2UodHlwZTogc3RyaW5nLCBjYWxsOiBBU1QuQ2FsbCk6IHN0cmluZyB7XG4gIGxldCB7IHBhcmFtcywgaGFzaCwgbG9jIH0gPSBjYWxsO1xuXG4gIGlmIChoYXNoICYmIGhhc2gucGFpcnMubGVuZ3RoID4gMCkge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihgJHt0eXBlfSBkb2VzIG5vdCB0YWtlIGFueSBuYW1lZCBhcmd1bWVudHNgLCBjYWxsLmxvYyk7XG4gIH1cblxuICBpZiAocGFyYW1zLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAnZGVmYXVsdCc7XG4gIH0gZWxzZSBpZiAocGFyYW1zLmxlbmd0aCA9PT0gMSkge1xuICAgIGxldCBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICBpZiAocGFyYW0udHlwZSA9PT0gJ1N0cmluZ0xpdGVyYWwnKSB7XG4gICAgICByZXR1cm4gcGFyYW0udmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcbiAgICAgICAgYHlvdSBjYW4gb25seSB5aWVsZCB0byBhIGxpdGVyYWwgdmFsdWUgKG9uIGxpbmUgJHtsb2Muc3RhcnQubGluZX0pYCxcbiAgICAgICAgY2FsbC5sb2NcbiAgICAgICk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcbiAgICAgIGAke3R5cGV9IG9ubHkgdGFrZXMgYSBzaW5nbGUgcG9zaXRpb25hbCBhcmd1bWVudCAob24gbGluZSAke2xvYy5zdGFydC5saW5lfSlgLFxuICAgICAgY2FsbC5sb2NcbiAgICApO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFzc2VydFZhbGlkRGVidWdnZXJVc2FnZShzdGF0ZW1lbnQ6IEFTVC5NdXN0YWNoZVN0YXRlbWVudCkge1xuICBsZXQgeyBwYXJhbXMsIGhhc2ggfSA9IHN0YXRlbWVudDtcblxuICBpZiAoaGFzaCAmJiBoYXNoLnBhaXJzLmxlbmd0aCA+IDApIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYGRlYnVnZ2VyIGRvZXMgbm90IHRha2UgYW55IG5hbWVkIGFyZ3VtZW50c2AsIHN0YXRlbWVudC5sb2MpO1xuICB9XG5cbiAgaWYgKHBhcmFtcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gJ2RlZmF1bHQnO1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihgZGVidWdnZXIgZG9lcyBub3QgdGFrZSBhbnkgcG9zaXRpb25hbCBhcmd1bWVudHNgLCBzdGF0ZW1lbnQubG9jKTtcbiAgfVxufVxuIl19