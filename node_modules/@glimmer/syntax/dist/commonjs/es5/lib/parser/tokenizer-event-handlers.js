"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.TokenizerEventHandlers = exports.voidMap = undefined;
exports.preprocess = preprocess;

var _builders = require("../builders");

var _builders2 = _interopRequireDefault(_builders);

var _utils = require("../utils");

var _handlebarsNodeVisitors = require("./handlebars-node-visitors");

var _syntaxError = require("../errors/syntax-error");

var _syntaxError2 = _interopRequireDefault(_syntaxError);

var _traverse = require("../traversal/traverse");

var _traverse2 = _interopRequireDefault(_traverse);

var _print = require("../generation/print");

var _print2 = _interopRequireDefault(_print);

var _walker = require("../traversal/walker");

var _walker2 = _interopRequireDefault(_walker);

var _handlebars = require("handlebars");

var handlebars = _interopRequireWildcard(_handlebars);

var _util = require("@glimmer/util");

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defaults(obj, defaults) {
    var keys = Object.getOwnPropertyNames(defaults);for (var i = 0; i < keys.length; i++) {
        var key = keys[i];var value = Object.getOwnPropertyDescriptor(defaults, key);if (value && value.configurable && obj[key] === undefined) {
            Object.defineProperty(obj, key, value);
        }
    }return obj;
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }return call && (typeof call === "object" || typeof call === "function") ? call : self;
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass);
}

var voidMap = exports.voidMap = Object.create(null);
var voidTagNames = 'area base br col command embed hr img input keygen link meta param source track wbr';
voidTagNames.split(' ').forEach(function (tagName) {
    voidMap[tagName] = true;
});
var TokenizerEventHandlers = exports.TokenizerEventHandlers = function (_HandlebarsNodeVisito) {
    _inherits(TokenizerEventHandlers, _HandlebarsNodeVisito);

    function TokenizerEventHandlers() {
        _classCallCheck(this, TokenizerEventHandlers);

        var _this = _possibleConstructorReturn(this, _HandlebarsNodeVisito.apply(this, arguments));

        _this.tagOpenLine = 0;
        _this.tagOpenColumn = 0;
        return _this;
    }

    TokenizerEventHandlers.prototype.reset = function reset() {
        this.currentNode = null;
    };
    // Comment


    TokenizerEventHandlers.prototype.beginComment = function beginComment() {
        this.currentNode = _builders2.default.comment('');
        this.currentNode.loc = {
            source: null,
            start: _builders2.default.pos(this.tagOpenLine, this.tagOpenColumn),
            end: null
        };
    };

    TokenizerEventHandlers.prototype.appendToCommentData = function appendToCommentData(char) {
        this.currentComment.value += char;
    };

    TokenizerEventHandlers.prototype.finishComment = function finishComment() {
        this.currentComment.loc.end = _builders2.default.pos(this.tokenizer.line, this.tokenizer.column);
        (0, _utils.appendChild)(this.currentElement(), this.currentComment);
    };
    // Data


    TokenizerEventHandlers.prototype.beginData = function beginData() {
        this.currentNode = _builders2.default.text();
        this.currentNode.loc = {
            source: null,
            start: _builders2.default.pos(this.tokenizer.line, this.tokenizer.column),
            end: null
        };
    };

    TokenizerEventHandlers.prototype.appendToData = function appendToData(char) {
        this.currentData.chars += char;
    };

    TokenizerEventHandlers.prototype.finishData = function finishData() {
        this.currentData.loc.end = _builders2.default.pos(this.tokenizer.line, this.tokenizer.column);
        (0, _utils.appendChild)(this.currentElement(), this.currentData);
    };
    // Tags - basic


    TokenizerEventHandlers.prototype.tagOpen = function tagOpen() {
        this.tagOpenLine = this.tokenizer.line;
        this.tagOpenColumn = this.tokenizer.column;
    };

    TokenizerEventHandlers.prototype.beginStartTag = function beginStartTag() {
        this.currentNode = {
            type: 'StartTag',
            name: '',
            attributes: [],
            modifiers: [],
            comments: [],
            selfClosing: false,
            loc: _builders.SYNTHETIC
        };
    };

    TokenizerEventHandlers.prototype.beginEndTag = function beginEndTag() {
        this.currentNode = {
            type: 'EndTag',
            name: '',
            attributes: [],
            modifiers: [],
            comments: [],
            selfClosing: false,
            loc: _builders.SYNTHETIC
        };
    };

    TokenizerEventHandlers.prototype.finishTag = function finishTag() {
        var _tokenizer = this.tokenizer,
            line = _tokenizer.line,
            column = _tokenizer.column;

        var tag = this.currentTag;
        tag.loc = _builders2.default.loc(this.tagOpenLine, this.tagOpenColumn, line, column);
        if (tag.type === 'StartTag') {
            this.finishStartTag();
            if (voidMap[tag.name] || tag.selfClosing) {
                this.finishEndTag(true);
            }
        } else if (tag.type === 'EndTag') {
            this.finishEndTag(false);
        }
    };

    TokenizerEventHandlers.prototype.finishStartTag = function finishStartTag() {
        var _currentStartTag = this.currentStartTag,
            name = _currentStartTag.name,
            attributes = _currentStartTag.attributes,
            modifiers = _currentStartTag.modifiers,
            comments = _currentStartTag.comments,
            selfClosing = _currentStartTag.selfClosing;

        var loc = _builders2.default.loc(this.tagOpenLine, this.tagOpenColumn);
        var element = _builders2.default.element({ name: name, selfClosing: selfClosing }, attributes, modifiers, [], comments, [], loc);
        this.elementStack.push(element);
    };

    TokenizerEventHandlers.prototype.finishEndTag = function finishEndTag(isVoid) {
        var tag = this.currentTag;
        var element = this.elementStack.pop();
        var parent = this.currentElement();
        validateEndTag(tag, element, isVoid);
        element.loc.end.line = this.tokenizer.line;
        element.loc.end.column = this.tokenizer.column;
        (0, _utils.parseElementBlockParams)(element);
        (0, _utils.appendChild)(parent, element);
    };

    TokenizerEventHandlers.prototype.markTagAsSelfClosing = function markTagAsSelfClosing() {
        this.currentTag.selfClosing = true;
    };
    // Tags - name


    TokenizerEventHandlers.prototype.appendToTagName = function appendToTagName(char) {
        this.currentTag.name += char;
    };
    // Tags - attributes


    TokenizerEventHandlers.prototype.beginAttribute = function beginAttribute() {
        var tag = this.currentTag;
        if (tag.type === 'EndTag') {
            throw new _syntaxError2.default('Invalid end tag: closing tag must not have attributes, ' + ('in `' + tag.name + '` (on line ' + this.tokenizer.line + ').'), tag.loc);
        }
        this.currentAttribute = {
            name: '',
            parts: [],
            isQuoted: false,
            isDynamic: false,
            start: _builders2.default.pos(this.tokenizer.line, this.tokenizer.column),
            valueStartLine: 0,
            valueStartColumn: 0
        };
    };

    TokenizerEventHandlers.prototype.appendToAttributeName = function appendToAttributeName(char) {
        this.currentAttr.name += char;
    };

    TokenizerEventHandlers.prototype.beginAttributeValue = function beginAttributeValue(isQuoted) {
        this.currentAttr.isQuoted = isQuoted;
        this.currentAttr.valueStartLine = this.tokenizer.line;
        this.currentAttr.valueStartColumn = this.tokenizer.column;
    };

    TokenizerEventHandlers.prototype.appendToAttributeValue = function appendToAttributeValue(char) {
        var parts = this.currentAttr.parts;
        var lastPart = parts[parts.length - 1];
        if (lastPart && lastPart.type === 'TextNode') {
            lastPart.chars += char;
            // update end location for each added char
            lastPart.loc.end.line = this.tokenizer.line;
            lastPart.loc.end.column = this.tokenizer.column;
        } else {
            // initially assume the text node is a single char
            var loc = _builders2.default.loc(this.tokenizer.line, this.tokenizer.column, this.tokenizer.line, this.tokenizer.column);
            // correct for `\n` as first char
            if (char === '\n') {
                loc.start.line -= 1;
                loc.start.column = lastPart ? lastPart.loc.end.column : this.currentAttr.valueStartColumn;
            }
            var text = _builders2.default.text(char, loc);
            parts.push(text);
        }
    };

    TokenizerEventHandlers.prototype.finishAttributeValue = function finishAttributeValue() {
        var _currentAttr = this.currentAttr,
            name = _currentAttr.name,
            parts = _currentAttr.parts,
            isQuoted = _currentAttr.isQuoted,
            isDynamic = _currentAttr.isDynamic,
            valueStartLine = _currentAttr.valueStartLine,
            valueStartColumn = _currentAttr.valueStartColumn;

        var value = assembleAttributeValue(parts, isQuoted, isDynamic, this.tokenizer.line);
        value.loc = _builders2.default.loc(valueStartLine, valueStartColumn, this.tokenizer.line, this.tokenizer.column);
        var loc = _builders2.default.loc(this.currentAttr.start.line, this.currentAttr.start.column, this.tokenizer.line, this.tokenizer.column);
        var attribute = _builders2.default.attr(name, value, loc);
        this.currentStartTag.attributes.push(attribute);
    };

    TokenizerEventHandlers.prototype.reportSyntaxError = function reportSyntaxError(message) {
        throw new _syntaxError2.default('Syntax error at line ' + this.tokenizer.line + ' col ' + this.tokenizer.column + ': ' + message, _builders2.default.loc(this.tokenizer.line, this.tokenizer.column));
    };

    return TokenizerEventHandlers;
}(_handlebarsNodeVisitors.HandlebarsNodeVisitors);
function assembleAttributeValue(parts, isQuoted, isDynamic, line) {
    if (isDynamic) {
        if (isQuoted) {
            return assembleConcatenatedValue(parts);
        } else {
            if (parts.length === 1 || parts.length === 2 && parts[1].type === 'TextNode' && parts[1].chars === '/') {
                return parts[0];
            } else {
                throw new _syntaxError2.default('An unquoted attribute value must be a string or a mustache, ' + 'preceeded by whitespace or a \'=\' character, and ' + ('followed by whitespace, a \'>\' character, or \'/>\' (on line ' + line + ')'), _builders2.default.loc(line, 0));
            }
        }
    } else {
        return parts.length > 0 ? parts[0] : _builders2.default.text('');
    }
}
function assembleConcatenatedValue(parts) {
    for (var i = 0; i < parts.length; i++) {
        var part = parts[i];
        if (part.type !== 'MustacheStatement' && part.type !== 'TextNode') {
            throw new _syntaxError2.default('Unsupported node in quoted attribute value: ' + part['type'], part.loc);
        }
    }
    return _builders2.default.concat(parts);
}
function validateEndTag(tag, element, selfClosing) {
    var error = void 0;
    if (voidMap[tag.name] && !selfClosing) {
        // EngTag is also called by StartTag for void and self-closing tags (i.e.
        // <input> or <br />, so we need to check for that here. Otherwise, we would
        // throw an error for those cases.
        error = 'Invalid end tag ' + formatEndTagInfo(tag) + ' (void elements cannot have end tags).';
    } else if (element.tag === undefined) {
        error = 'Closing tag ' + formatEndTagInfo(tag) + ' without an open tag.';
    } else if (element.tag !== tag.name) {
        error = 'Closing tag ' + formatEndTagInfo(tag) + ' did not match last open tag `' + element.tag + '` (on line ' + element.loc.start.line + ').';
    }
    if (error) {
        throw new _syntaxError2.default(error, element.loc);
    }
}
function formatEndTagInfo(tag) {
    return '`' + tag.name + '` (on line ' + tag.loc.end.line + ')';
}
var syntax = {
    parse: preprocess,
    builders: _builders2.default,
    print: _print2.default,
    traverse: _traverse2.default,
    Walker: _walker2.default
};
function preprocess(html, options) {
    var ast = typeof html === 'object' ? html : handlebars.parse(html);
    var program = new TokenizerEventHandlers(html).acceptNode(ast);
    if (options && options.plugins && options.plugins.ast) {
        for (var i = 0, l = options.plugins.ast.length; i < l; i++) {
            var transform = options.plugins.ast[i];
            var env = (0, _util.assign)({}, options, { syntax: syntax }, { plugins: undefined });
            var pluginResult = transform(env);
            (0, _traverse2.default)(program, pluginResult.visitor);
        }
    }
    return program;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW5pemVyLWV2ZW50LWhhbmRsZXJzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvQGdsaW1tZXIvc3ludGF4L2xpYi9wYXJzZXIvdG9rZW5pemVyLWV2ZW50LWhhbmRsZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztRQTBXZ0IsQUFBVTs7QUExVzFCLEFBQU8sQUFBQyxBQUFFLEFBQUUsQUFBUyxBQUFFLEFBQU0sQUFBYSxBQUFDOzs7O0FBQzNDLEFBQU8sQUFBRSxBQUFXLEFBQUUsQUFBdUIsQUFBRSxBQUFNLEFBQVUsQUFBQzs7QUFDaEUsQUFBTyxBQUFFLEFBQXNCLEFBQUUsQUFBTSxBQUE0QixBQUFDOztBQUVwRSxBQUFPLEFBQVcsQUFBTSxBQUF3QixBQUFDLEFBRWpELEFBQU8sQUFBUSxBQUFNLEFBQWEsQUFBQzs7OztBQUNuQyxBQUFPLEFBQVEsQUFBTSxBQUF1QixBQUFDOzs7O0FBRTdDLEFBQU8sQUFBSyxBQUFNLEFBQXFCLEFBQUM7Ozs7QUFDeEMsQUFBTyxBQUFNLEFBQU0sQUFBcUIsQUFBQzs7OztBQUN6QyxBQUFPOztJQUFLLEFBQVUsQUFBTSxBQUFZLEFBQUM7O0FBQ3pDLEFBQU8sQUFBRSxBQUFNLEFBQUUsQUFBTSxBQUFlLEFBQUMsQUFFdkMsQUFBTTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQyxJQUFNLEFBQU8sNEJBRWhCLEFBQU0sT0FBQyxBQUFNLE9BQUMsQUFBSSxBQUFDLEFBQUM7QUFFeEIsSUFBSSxBQUFZLGVBQ2QsQUFBcUYsQUFBQztBQUN4RixBQUFZLGFBQUMsQUFBSyxNQUFDLEFBQUcsQUFBQyxLQUFDLEFBQU8sUUFBQyxBQUFPLEFBQUMsQUFBRSxtQkFDeEMsQUFBTztZQUFDLEFBQU8sQUFBQyxXQUFHLEFBQUksQUFBQyxBQUMxQixBQUFDLEFBQUMsQUFBQztBQUVILEFBQU07SUFBTyxBQUF1Qjs7Ozs7O3VGQUMxQjs7Y0FB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TyxBQUFJLFNBQUssQUFBUSxBQUFDLEFBQUMsV0FBQyxBQUFJLEFBQUMsQUFBQyxPQUFDLEFBQVUsV0FBQyxBQUFLLE1BQUMsQUFBSSxBQUFDLEFBQUMsQUFDbkU7UUFBSSxBQUFPLFVBQUcsSUFBSSxBQUFzQix1QkFBQyxBQUFJLEFBQUMsTUFBQyxBQUFVLFdBQUMsQUFBRyxBQUFDLEFBQUMsQUFFL0Q7UUFBSSxBQUFPLFdBQUksQUFBTyxRQUFDLEFBQU8sV0FBSSxBQUFPLFFBQUMsQUFBTyxRQUFDLEFBQUcsS0FBRSxBQUNyRDthQUFLLElBQUksQUFBQyxJQUFHLEFBQUMsR0FBRSxBQUFDLElBQUcsQUFBTyxRQUFDLEFBQU8sUUFBQyxBQUFHLElBQUMsQUFBTSxRQUFFLEFBQUMsSUFBRyxBQUFDLEdBQUUsQUFBQyxBQUFFLEtBQUUsQUFDMUQ7Z0JBQUksQUFBUyxZQUFHLEFBQU8sUUFBQyxBQUFPLFFBQUMsQUFBRyxJQUFDLEFBQUMsQUFBQyxBQUFDLEFBQ3ZDO2dCQUFJLEFBQUcsTUFBRyxBQUFNLGtCQUFDLEFBQUUsSUFBRSxBQUFPLFNBQUUsRUFBRSxBQUFNLEFBQUUsa0JBQUUsRUFBRSxBQUFPLFNBQUUsQUFBUyxBQUFFLEFBQUMsQUFBQyxBQUVsRTtnQkFBSSxBQUFZLGVBQUcsQUFBUyxVQUFDLEFBQUcsQUFBQyxBQUFDLEFBRWxDLEFBQVE7b0NBQUMsQUFBTyxTQUFFLEFBQVksYUFBQyxBQUFPLEFBQUMsQUFBQyxBQUN6QyxBQUNGO0FBRUQ7O1dBQU8sQUFBTyxBQUFDLEFBQ2pCLEFBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYiwgeyBTWU5USEVUSUMgfSBmcm9tICcuLi9idWlsZGVycyc7XG5pbXBvcnQgeyBhcHBlbmRDaGlsZCwgcGFyc2VFbGVtZW50QmxvY2tQYXJhbXMgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyBIYW5kbGViYXJzTm9kZVZpc2l0b3JzIH0gZnJvbSAnLi9oYW5kbGViYXJzLW5vZGUtdmlzaXRvcnMnO1xuaW1wb3J0ICogYXMgQVNUIGZyb20gJy4uL3R5cGVzL25vZGVzJztcbmltcG9ydCBTeW50YXhFcnJvciBmcm9tICcuLi9lcnJvcnMvc3ludGF4LWVycm9yJztcbmltcG9ydCB7IFRhZyB9IGZyb20gJy4uL3BhcnNlcic7XG5pbXBvcnQgYnVpbGRlcnMgZnJvbSAnLi4vYnVpbGRlcnMnO1xuaW1wb3J0IHRyYXZlcnNlIGZyb20gJy4uL3RyYXZlcnNhbC90cmF2ZXJzZSc7XG5pbXBvcnQgeyBOb2RlVmlzaXRvciB9IGZyb20gJy4uL3R5cGVzL3Zpc2l0b3InO1xuaW1wb3J0IHByaW50IGZyb20gJy4uL2dlbmVyYXRpb24vcHJpbnQnO1xuaW1wb3J0IFdhbGtlciBmcm9tICcuLi90cmF2ZXJzYWwvd2Fsa2VyJztcbmltcG9ydCAqIGFzIGhhbmRsZWJhcnMgZnJvbSAnaGFuZGxlYmFycyc7XG5pbXBvcnQgeyBhc3NpZ24gfSBmcm9tICdAZ2xpbW1lci91dGlsJztcblxuZXhwb3J0IGNvbnN0IHZvaWRNYXA6IHtcbiAgW3RhZ05hbWU6IHN0cmluZ106IGJvb2xlYW47XG59ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxubGV0IHZvaWRUYWdOYW1lcyA9XG4gICdhcmVhIGJhc2UgYnIgY29sIGNvbW1hbmQgZW1iZWQgaHIgaW1nIGlucHV0IGtleWdlbiBsaW5rIG1ldGEgcGFyYW0gc291cmNlIHRyYWNrIHdicic7XG52b2lkVGFnTmFtZXMuc3BsaXQoJyAnKS5mb3JFYWNoKHRhZ05hbWUgPT4ge1xuICB2b2lkTWFwW3RhZ05hbWVdID0gdHJ1ZTtcbn0pO1xuXG5leHBvcnQgY2xhc3MgVG9rZW5pemVyRXZlbnRIYW5kbGVycyBleHRlbmRzIEhhbmRsZWJhcnNOb2RlVmlzaXRvcnMge1xuICBwcml2YXRlIHRhZ09wZW5MaW5lID0gMDtcbiAgcHJpdmF0ZSB0YWdPcGVuQ29sdW1uID0gMDtcblxuICByZXNldCgpIHtcbiAgICB0aGlzLmN1cnJlbnROb2RlID0gbnVsbDtcbiAgfVxuXG4gIC8vIENvbW1lbnRcblxuICBiZWdpbkNvbW1lbnQoKSB7XG4gICAgdGhpcy5jdXJyZW50Tm9kZSA9IGIuY29tbWVudCgnJyk7XG4gICAgdGhpcy5jdXJyZW50Tm9kZS5sb2MgPSB7XG4gICAgICBzb3VyY2U6IG51bGwsXG4gICAgICBzdGFydDogYi5wb3ModGhpcy50YWdPcGVuTGluZSwgdGhpcy50YWdPcGVuQ29sdW1uKSxcbiAgICAgIGVuZDogKG51bGwgYXMgYW55KSBhcyBBU1QuUG9zaXRpb24sXG4gICAgfTtcbiAgfVxuXG4gIGFwcGVuZFRvQ29tbWVudERhdGEoY2hhcjogc3RyaW5nKSB7XG4gICAgdGhpcy5jdXJyZW50Q29tbWVudC52YWx1ZSArPSBjaGFyO1xuICB9XG5cbiAgZmluaXNoQ29tbWVudCgpIHtcbiAgICB0aGlzLmN1cnJlbnRDb21tZW50LmxvYy5lbmQgPSBiLnBvcyh0aGlzLnRva2VuaXplci5saW5lLCB0aGlzLnRva2VuaXplci5jb2x1bW4pO1xuXG4gICAgYXBwZW5kQ2hpbGQodGhpcy5jdXJyZW50RWxlbWVudCgpLCB0aGlzLmN1cnJlbnRDb21tZW50KTtcbiAgfVxuXG4gIC8vIERhdGFcblxuICBiZWdpbkRhdGEoKSB7XG4gICAgdGhpcy5jdXJyZW50Tm9kZSA9IGIudGV4dCgpO1xuICAgIHRoaXMuY3VycmVudE5vZGUubG9jID0ge1xuICAgICAgc291cmNlOiBudWxsLFxuICAgICAgc3RhcnQ6IGIucG9zKHRoaXMudG9rZW5pemVyLmxpbmUsIHRoaXMudG9rZW5pemVyLmNvbHVtbiksXG4gICAgICBlbmQ6IChudWxsIGFzIGFueSkgYXMgQVNULlBvc2l0aW9uLFxuICAgIH07XG4gIH1cblxuICBhcHBlbmRUb0RhdGEoY2hhcjogc3RyaW5nKSB7XG4gICAgdGhpcy5jdXJyZW50RGF0YS5jaGFycyArPSBjaGFyO1xuICB9XG5cbiAgZmluaXNoRGF0YSgpIHtcbiAgICB0aGlzLmN1cnJlbnREYXRhLmxvYy5lbmQgPSBiLnBvcyh0aGlzLnRva2VuaXplci5saW5lLCB0aGlzLnRva2VuaXplci5jb2x1bW4pO1xuXG4gICAgYXBwZW5kQ2hpbGQodGhpcy5jdXJyZW50RWxlbWVudCgpLCB0aGlzLmN1cnJlbnREYXRhKTtcbiAgfVxuXG4gIC8vIFRhZ3MgLSBiYXNpY1xuXG4gIHRhZ09wZW4oKSB7XG4gICAgdGhpcy50YWdPcGVuTGluZSA9IHRoaXMudG9rZW5pemVyLmxpbmU7XG4gICAgdGhpcy50YWdPcGVuQ29sdW1uID0gdGhpcy50b2tlbml6ZXIuY29sdW1uO1xuICB9XG5cbiAgYmVnaW5TdGFydFRhZygpIHtcbiAgICB0aGlzLmN1cnJlbnROb2RlID0ge1xuICAgICAgdHlwZTogJ1N0YXJ0VGFnJyxcbiAgICAgIG5hbWU6ICcnLFxuICAgICAgYXR0cmlidXRlczogW10sXG4gICAgICBtb2RpZmllcnM6IFtdLFxuICAgICAgY29tbWVudHM6IFtdLFxuICAgICAgc2VsZkNsb3Npbmc6IGZhbHNlLFxuICAgICAgbG9jOiBTWU5USEVUSUMsXG4gICAgfTtcbiAgfVxuXG4gIGJlZ2luRW5kVGFnKCkge1xuICAgIHRoaXMuY3VycmVudE5vZGUgPSB7XG4gICAgICB0eXBlOiAnRW5kVGFnJyxcbiAgICAgIG5hbWU6ICcnLFxuICAgICAgYXR0cmlidXRlczogW10sXG4gICAgICBtb2RpZmllcnM6IFtdLFxuICAgICAgY29tbWVudHM6IFtdLFxuICAgICAgc2VsZkNsb3Npbmc6IGZhbHNlLFxuICAgICAgbG9jOiBTWU5USEVUSUMsXG4gICAgfTtcbiAgfVxuXG4gIGZpbmlzaFRhZygpIHtcbiAgICBsZXQgeyBsaW5lLCBjb2x1bW4gfSA9IHRoaXMudG9rZW5pemVyO1xuXG4gICAgbGV0IHRhZyA9IHRoaXMuY3VycmVudFRhZztcbiAgICB0YWcubG9jID0gYi5sb2ModGhpcy50YWdPcGVuTGluZSwgdGhpcy50YWdPcGVuQ29sdW1uLCBsaW5lLCBjb2x1bW4pO1xuXG4gICAgaWYgKHRhZy50eXBlID09PSAnU3RhcnRUYWcnKSB7XG4gICAgICB0aGlzLmZpbmlzaFN0YXJ0VGFnKCk7XG5cbiAgICAgIGlmICh2b2lkTWFwW3RhZy5uYW1lXSB8fCB0YWcuc2VsZkNsb3NpbmcpIHtcbiAgICAgICAgdGhpcy5maW5pc2hFbmRUYWcodHJ1ZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0YWcudHlwZSA9PT0gJ0VuZFRhZycpIHtcbiAgICAgIHRoaXMuZmluaXNoRW5kVGFnKGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICBmaW5pc2hTdGFydFRhZygpIHtcbiAgICBsZXQgeyBuYW1lLCBhdHRyaWJ1dGVzLCBtb2RpZmllcnMsIGNvbW1lbnRzLCBzZWxmQ2xvc2luZyB9ID0gdGhpcy5jdXJyZW50U3RhcnRUYWc7XG4gICAgbGV0IGxvYyA9IGIubG9jKHRoaXMudGFnT3BlbkxpbmUsIHRoaXMudGFnT3BlbkNvbHVtbik7XG4gICAgbGV0IGVsZW1lbnQgPSBiLmVsZW1lbnQoeyBuYW1lLCBzZWxmQ2xvc2luZyB9LCBhdHRyaWJ1dGVzLCBtb2RpZmllcnMsIFtdLCBjb21tZW50cywgW10sIGxvYyk7XG4gICAgdGhpcy5lbGVtZW50U3RhY2sucHVzaChlbGVtZW50KTtcbiAgfVxuXG4gIGZpbmlzaEVuZFRhZyhpc1ZvaWQ6IGJvb2xlYW4pIHtcbiAgICBsZXQgdGFnID0gdGhpcy5jdXJyZW50VGFnO1xuXG4gICAgbGV0IGVsZW1lbnQgPSB0aGlzLmVsZW1lbnRTdGFjay5wb3AoKSBhcyBBU1QuRWxlbWVudE5vZGU7XG4gICAgbGV0IHBhcmVudCA9IHRoaXMuY3VycmVudEVsZW1lbnQoKTtcblxuICAgIHZhbGlkYXRlRW5kVGFnKHRhZywgZWxlbWVudCwgaXNWb2lkKTtcblxuICAgIGVsZW1lbnQubG9jLmVuZC5saW5lID0gdGhpcy50b2tlbml6ZXIubGluZTtcbiAgICBlbGVtZW50LmxvYy5lbmQuY29sdW1uID0gdGhpcy50b2tlbml6ZXIuY29sdW1uO1xuXG4gICAgcGFyc2VFbGVtZW50QmxvY2tQYXJhbXMoZWxlbWVudCk7XG4gICAgYXBwZW5kQ2hpbGQocGFyZW50LCBlbGVtZW50KTtcbiAgfVxuXG4gIG1hcmtUYWdBc1NlbGZDbG9zaW5nKCkge1xuICAgIHRoaXMuY3VycmVudFRhZy5zZWxmQ2xvc2luZyA9IHRydWU7XG4gIH1cblxuICAvLyBUYWdzIC0gbmFtZVxuXG4gIGFwcGVuZFRvVGFnTmFtZShjaGFyOiBzdHJpbmcpIHtcbiAgICB0aGlzLmN1cnJlbnRUYWcubmFtZSArPSBjaGFyO1xuICB9XG5cbiAgLy8gVGFncyAtIGF0dHJpYnV0ZXNcblxuICBiZWdpbkF0dHJpYnV0ZSgpIHtcbiAgICBsZXQgdGFnID0gdGhpcy5jdXJyZW50VGFnO1xuICAgIGlmICh0YWcudHlwZSA9PT0gJ0VuZFRhZycpIHtcbiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcbiAgICAgICAgYEludmFsaWQgZW5kIHRhZzogY2xvc2luZyB0YWcgbXVzdCBub3QgaGF2ZSBhdHRyaWJ1dGVzLCBgICtcbiAgICAgICAgICBgaW4gXFxgJHt0YWcubmFtZX1cXGAgKG9uIGxpbmUgJHt0aGlzLnRva2VuaXplci5saW5lfSkuYCxcbiAgICAgICAgdGFnLmxvY1xuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRBdHRyaWJ1dGUgPSB7XG4gICAgICBuYW1lOiAnJyxcbiAgICAgIHBhcnRzOiBbXSxcbiAgICAgIGlzUXVvdGVkOiBmYWxzZSxcbiAgICAgIGlzRHluYW1pYzogZmFsc2UsXG4gICAgICBzdGFydDogYi5wb3ModGhpcy50b2tlbml6ZXIubGluZSwgdGhpcy50b2tlbml6ZXIuY29sdW1uKSxcbiAgICAgIHZhbHVlU3RhcnRMaW5lOiAwLFxuICAgICAgdmFsdWVTdGFydENvbHVtbjogMCxcbiAgICB9O1xuICB9XG5cbiAgYXBwZW5kVG9BdHRyaWJ1dGVOYW1lKGNoYXI6IHN0cmluZykge1xuICAgIHRoaXMuY3VycmVudEF0dHIubmFtZSArPSBjaGFyO1xuICB9XG5cbiAgYmVnaW5BdHRyaWJ1dGVWYWx1ZShpc1F1b3RlZDogYm9vbGVhbikge1xuICAgIHRoaXMuY3VycmVudEF0dHIuaXNRdW90ZWQgPSBpc1F1b3RlZDtcbiAgICB0aGlzLmN1cnJlbnRBdHRyLnZhbHVlU3RhcnRMaW5lID0gdGhpcy50b2tlbml6ZXIubGluZTtcbiAgICB0aGlzLmN1cnJlbnRBdHRyLnZhbHVlU3RhcnRDb2x1bW4gPSB0aGlzLnRva2VuaXplci5jb2x1bW47XG4gIH1cblxuICBhcHBlbmRUb0F0dHJpYnV0ZVZhbHVlKGNoYXI6IHN0cmluZykge1xuICAgIGxldCBwYXJ0cyA9IHRoaXMuY3VycmVudEF0dHIucGFydHM7XG4gICAgbGV0IGxhc3RQYXJ0ID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV07XG5cbiAgICBpZiAobGFzdFBhcnQgJiYgbGFzdFBhcnQudHlwZSA9PT0gJ1RleHROb2RlJykge1xuICAgICAgbGFzdFBhcnQuY2hhcnMgKz0gY2hhcjtcblxuICAgICAgLy8gdXBkYXRlIGVuZCBsb2NhdGlvbiBmb3IgZWFjaCBhZGRlZCBjaGFyXG4gICAgICBsYXN0UGFydC5sb2MuZW5kLmxpbmUgPSB0aGlzLnRva2VuaXplci5saW5lO1xuICAgICAgbGFzdFBhcnQubG9jLmVuZC5jb2x1bW4gPSB0aGlzLnRva2VuaXplci5jb2x1bW47XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGluaXRpYWxseSBhc3N1bWUgdGhlIHRleHQgbm9kZSBpcyBhIHNpbmdsZSBjaGFyXG4gICAgICBsZXQgbG9jID0gYi5sb2MoXG4gICAgICAgIHRoaXMudG9rZW5pemVyLmxpbmUsXG4gICAgICAgIHRoaXMudG9rZW5pemVyLmNvbHVtbixcbiAgICAgICAgdGhpcy50b2tlbml6ZXIubGluZSxcbiAgICAgICAgdGhpcy50b2tlbml6ZXIuY29sdW1uXG4gICAgICApO1xuXG4gICAgICAvLyBjb3JyZWN0IGZvciBgXFxuYCBhcyBmaXJzdCBjaGFyXG4gICAgICBpZiAoY2hhciA9PT0gJ1xcbicpIHtcbiAgICAgICAgbG9jLnN0YXJ0LmxpbmUgLT0gMTtcbiAgICAgICAgbG9jLnN0YXJ0LmNvbHVtbiA9IGxhc3RQYXJ0ID8gbGFzdFBhcnQubG9jLmVuZC5jb2x1bW4gOiB0aGlzLmN1cnJlbnRBdHRyLnZhbHVlU3RhcnRDb2x1bW47XG4gICAgICB9XG5cbiAgICAgIGxldCB0ZXh0ID0gYi50ZXh0KGNoYXIsIGxvYyk7XG4gICAgICBwYXJ0cy5wdXNoKHRleHQpO1xuICAgIH1cbiAgfVxuXG4gIGZpbmlzaEF0dHJpYnV0ZVZhbHVlKCkge1xuICAgIGxldCB7IG5hbWUsIHBhcnRzLCBpc1F1b3RlZCwgaXNEeW5hbWljLCB2YWx1ZVN0YXJ0TGluZSwgdmFsdWVTdGFydENvbHVtbiB9ID0gdGhpcy5jdXJyZW50QXR0cjtcbiAgICBsZXQgdmFsdWUgPSBhc3NlbWJsZUF0dHJpYnV0ZVZhbHVlKHBhcnRzLCBpc1F1b3RlZCwgaXNEeW5hbWljLCB0aGlzLnRva2VuaXplci5saW5lKTtcbiAgICB2YWx1ZS5sb2MgPSBiLmxvYyh2YWx1ZVN0YXJ0TGluZSwgdmFsdWVTdGFydENvbHVtbiwgdGhpcy50b2tlbml6ZXIubGluZSwgdGhpcy50b2tlbml6ZXIuY29sdW1uKTtcblxuICAgIGxldCBsb2MgPSBiLmxvYyhcbiAgICAgIHRoaXMuY3VycmVudEF0dHIuc3RhcnQubGluZSxcbiAgICAgIHRoaXMuY3VycmVudEF0dHIuc3RhcnQuY29sdW1uLFxuICAgICAgdGhpcy50b2tlbml6ZXIubGluZSxcbiAgICAgIHRoaXMudG9rZW5pemVyLmNvbHVtblxuICAgICk7XG5cbiAgICBsZXQgYXR0cmlidXRlID0gYi5hdHRyKG5hbWUsIHZhbHVlLCBsb2MpO1xuXG4gICAgdGhpcy5jdXJyZW50U3RhcnRUYWcuYXR0cmlidXRlcy5wdXNoKGF0dHJpYnV0ZSk7XG4gIH1cblxuICByZXBvcnRTeW50YXhFcnJvcihtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICBgU3ludGF4IGVycm9yIGF0IGxpbmUgJHt0aGlzLnRva2VuaXplci5saW5lfSBjb2wgJHt0aGlzLnRva2VuaXplci5jb2x1bW59OiAke21lc3NhZ2V9YCxcbiAgICAgIGIubG9jKHRoaXMudG9rZW5pemVyLmxpbmUsIHRoaXMudG9rZW5pemVyLmNvbHVtbilcbiAgICApO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFzc2VtYmxlQXR0cmlidXRlVmFsdWUoXG4gIHBhcnRzOiAoQVNULk11c3RhY2hlU3RhdGVtZW50IHwgQVNULlRleHROb2RlKVtdLFxuICBpc1F1b3RlZDogYm9vbGVhbixcbiAgaXNEeW5hbWljOiBib29sZWFuLFxuICBsaW5lOiBudW1iZXJcbikge1xuICBpZiAoaXNEeW5hbWljKSB7XG4gICAgaWYgKGlzUXVvdGVkKSB7XG4gICAgICByZXR1cm4gYXNzZW1ibGVDb25jYXRlbmF0ZWRWYWx1ZShwYXJ0cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChcbiAgICAgICAgcGFydHMubGVuZ3RoID09PSAxIHx8XG4gICAgICAgIChwYXJ0cy5sZW5ndGggPT09IDIgJiZcbiAgICAgICAgICBwYXJ0c1sxXS50eXBlID09PSAnVGV4dE5vZGUnICYmXG4gICAgICAgICAgKHBhcnRzWzFdIGFzIEFTVC5UZXh0Tm9kZSkuY2hhcnMgPT09ICcvJylcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gcGFydHNbMF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoXG4gICAgICAgICAgYEFuIHVucXVvdGVkIGF0dHJpYnV0ZSB2YWx1ZSBtdXN0IGJlIGEgc3RyaW5nIG9yIGEgbXVzdGFjaGUsIGAgK1xuICAgICAgICAgICAgYHByZWNlZWRlZCBieSB3aGl0ZXNwYWNlIG9yIGEgJz0nIGNoYXJhY3RlciwgYW5kIGAgK1xuICAgICAgICAgICAgYGZvbGxvd2VkIGJ5IHdoaXRlc3BhY2UsIGEgJz4nIGNoYXJhY3Rlciwgb3IgJy8+JyAob24gbGluZSAke2xpbmV9KWAsXG4gICAgICAgICAgYi5sb2MobGluZSwgMClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHBhcnRzLmxlbmd0aCA+IDAgPyBwYXJ0c1swXSA6IGIudGV4dCgnJyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXNzZW1ibGVDb25jYXRlbmF0ZWRWYWx1ZShwYXJ0czogKEFTVC5NdXN0YWNoZVN0YXRlbWVudCB8IEFTVC5UZXh0Tm9kZSlbXSkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IHBhcnQ6IEFTVC5CYXNlTm9kZSA9IHBhcnRzW2ldO1xuXG4gICAgaWYgKHBhcnQudHlwZSAhPT0gJ011c3RhY2hlU3RhdGVtZW50JyAmJiBwYXJ0LnR5cGUgIT09ICdUZXh0Tm9kZScpIHtcbiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcbiAgICAgICAgJ1Vuc3VwcG9ydGVkIG5vZGUgaW4gcXVvdGVkIGF0dHJpYnV0ZSB2YWx1ZTogJyArIHBhcnRbJ3R5cGUnXSxcbiAgICAgICAgcGFydC5sb2NcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGIuY29uY2F0KHBhcnRzKTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVFbmRUYWcoXG4gIHRhZzogVGFnPCdTdGFydFRhZycgfCAnRW5kVGFnJz4sXG4gIGVsZW1lbnQ6IEFTVC5FbGVtZW50Tm9kZSxcbiAgc2VsZkNsb3Npbmc6IGJvb2xlYW5cbikge1xuICBsZXQgZXJyb3I7XG5cbiAgaWYgKHZvaWRNYXBbdGFnLm5hbWVdICYmICFzZWxmQ2xvc2luZykge1xuICAgIC8vIEVuZ1RhZyBpcyBhbHNvIGNhbGxlZCBieSBTdGFydFRhZyBmb3Igdm9pZCBhbmQgc2VsZi1jbG9zaW5nIHRhZ3MgKGkuZS5cbiAgICAvLyA8aW5wdXQ+IG9yIDxiciAvPiwgc28gd2UgbmVlZCB0byBjaGVjayBmb3IgdGhhdCBoZXJlLiBPdGhlcndpc2UsIHdlIHdvdWxkXG4gICAgLy8gdGhyb3cgYW4gZXJyb3IgZm9yIHRob3NlIGNhc2VzLlxuICAgIGVycm9yID0gJ0ludmFsaWQgZW5kIHRhZyAnICsgZm9ybWF0RW5kVGFnSW5mbyh0YWcpICsgJyAodm9pZCBlbGVtZW50cyBjYW5ub3QgaGF2ZSBlbmQgdGFncykuJztcbiAgfSBlbHNlIGlmIChlbGVtZW50LnRhZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZXJyb3IgPSAnQ2xvc2luZyB0YWcgJyArIGZvcm1hdEVuZFRhZ0luZm8odGFnKSArICcgd2l0aG91dCBhbiBvcGVuIHRhZy4nO1xuICB9IGVsc2UgaWYgKGVsZW1lbnQudGFnICE9PSB0YWcubmFtZSkge1xuICAgIGVycm9yID1cbiAgICAgICdDbG9zaW5nIHRhZyAnICtcbiAgICAgIGZvcm1hdEVuZFRhZ0luZm8odGFnKSArXG4gICAgICAnIGRpZCBub3QgbWF0Y2ggbGFzdCBvcGVuIHRhZyBgJyArXG4gICAgICBlbGVtZW50LnRhZyArXG4gICAgICAnYCAob24gbGluZSAnICtcbiAgICAgIGVsZW1lbnQubG9jLnN0YXJ0LmxpbmUgK1xuICAgICAgJykuJztcbiAgfVxuXG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihlcnJvciwgZWxlbWVudC5sb2MpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGZvcm1hdEVuZFRhZ0luZm8odGFnOiBUYWc8J1N0YXJ0VGFnJyB8ICdFbmRUYWcnPikge1xuICByZXR1cm4gJ2AnICsgdGFnLm5hbWUgKyAnYCAob24gbGluZSAnICsgdGFnLmxvYy5lbmQubGluZSArICcpJztcbn1cblxuLyoqXG4gIEFTVFBsdWdpbnMgY2FuIG1ha2UgY2hhbmdlcyB0byB0aGUgR2xpbW1lciB0ZW1wbGF0ZSBBU1QgYmVmb3JlXG4gIGNvbXBpbGF0aW9uIGJlZ2lucy5cbiovXG5leHBvcnQgaW50ZXJmYWNlIEFTVFBsdWdpbkJ1aWxkZXIge1xuICAoZW52OiBBU1RQbHVnaW5FbnZpcm9ubWVudCk6IEFTVFBsdWdpbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBU1RQbHVnaW4ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHZpc2l0b3I6IE5vZGVWaXNpdG9yO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFTVFBsdWdpbkVudmlyb25tZW50IHtcbiAgbWV0YT86IGFueTtcbiAgc3ludGF4OiBTeW50YXg7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJlcHJvY2Vzc09wdGlvbnMge1xuICBwbHVnaW5zPzoge1xuICAgIGFzdD86IEFTVFBsdWdpbkJ1aWxkZXJbXTtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTeW50YXgge1xuICBwYXJzZTogdHlwZW9mIHByZXByb2Nlc3M7XG4gIGJ1aWxkZXJzOiB0eXBlb2YgYnVpbGRlcnM7XG4gIHByaW50OiB0eXBlb2YgcHJpbnQ7XG4gIHRyYXZlcnNlOiB0eXBlb2YgdHJhdmVyc2U7XG4gIFdhbGtlcjogdHlwZW9mIFdhbGtlcjtcbn1cblxuY29uc3Qgc3ludGF4OiBTeW50YXggPSB7XG4gIHBhcnNlOiBwcmVwcm9jZXNzLFxuICBidWlsZGVycyxcbiAgcHJpbnQsXG4gIHRyYXZlcnNlLFxuICBXYWxrZXIsXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gcHJlcHJvY2VzcyhodG1sOiBzdHJpbmcsIG9wdGlvbnM/OiBQcmVwcm9jZXNzT3B0aW9ucyk6IEFTVC5Qcm9ncmFtIHtcbiAgbGV0IGFzdCA9IHR5cGVvZiBodG1sID09PSAnb2JqZWN0JyA/IGh0bWwgOiBoYW5kbGViYXJzLnBhcnNlKGh0bWwpO1xuICBsZXQgcHJvZ3JhbSA9IG5ldyBUb2tlbml6ZXJFdmVudEhhbmRsZXJzKGh0bWwpLmFjY2VwdE5vZGUoYXN0KTtcblxuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnBsdWdpbnMgJiYgb3B0aW9ucy5wbHVnaW5zLmFzdCkge1xuICAgIGZvciAobGV0IGkgPSAwLCBsID0gb3B0aW9ucy5wbHVnaW5zLmFzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIGxldCB0cmFuc2Zvcm0gPSBvcHRpb25zLnBsdWdpbnMuYXN0W2ldO1xuICAgICAgbGV0IGVudiA9IGFzc2lnbih7fSwgb3B0aW9ucywgeyBzeW50YXggfSwgeyBwbHVnaW5zOiB1bmRlZmluZWQgfSk7XG5cbiAgICAgIGxldCBwbHVnaW5SZXN1bHQgPSB0cmFuc2Zvcm0oZW52KTtcblxuICAgICAgdHJhdmVyc2UocHJvZ3JhbSwgcGx1Z2luUmVzdWx0LnZpc2l0b3IpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBwcm9ncmFtO1xufVxuIl19